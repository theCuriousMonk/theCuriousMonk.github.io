<!DOCTYPE html><html lang="en">
<!-- Mirrored from javascript.info/call-apply-decorators by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:49:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><title itemprop="name">Decorators and forwarding, call/apply</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="call-apply-decorators.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><!-- favicon the rest--><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="Decorators and forwarding, call/apply"><meta property="og:image" content="https://javascript.info/img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Decorators and forwarding, call/apply"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://javascript.info/img/site_preview_en_512x512.png"><link href="pack/styles.b363cbd7204b6ec74a4cbeca7061b31d.css" rel="stylesheet"><link rel="prev" href="settimeout-setinterval.html"><link rel="next" href="bind.html"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 32184394;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var n=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),r=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+n+" "+r,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="inite4da.js?5"></script><script src="pack/head.5ac6aee21473ea597203.js" defer></script><meta property="og:title" content="Decorators and forwarding, call/apply"><meta property="og:type" content="article"><script src="pack/tutorial.5ac6aee21473ea597203.js" defer></script><script src="pack/footer.5ac6aee21473ea597203.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Sorry, IE&lt;10 is not supported, please use a newer browser.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div style="display:none" id="notify-en-tutorial" class="notification notification_info notification_top sitetoolbar__notification"><div class="notification__content">The tutorial was recently rewritten from scratch. There may be typos, please use the "Edit on Github" link (in left sidebar in an article, at the bottom) to propose fixes.
Thank you!</div><button title="Close" class="notification__close"></button></div><script>showTopNotification();</script><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a href="index.html" class="sitetoolbar__link sitetoolbar__link_logo"><img src="img/sitetoolbar__logo_en.svg" width="200" class="sitetoolbar__logo sitetoolbar__logo_normal" alt=""><img src="img/sitetoolbar__logo_small_en.svg" width="70" class="sitetoolbar__logo sitetoolbar__logo_small" alt=""><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){var t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button type="button" class="sitetoolbar__nav-toggle"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a href="index.html" class="sitetoolbar__link">Tutorial</a></li><li class="sitetoolbar__section"><a href="courses.html" class="sitetoolbar__link">Courses</a></li></ul></nav><div class="sitetoolbar__book-wrap"><a href="ebook.html" class="buy-book-button"><span class="buy-book-button__extra-text">Buy</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button data-action-login class="sitetoolbar__login sitetoolbar__login_unready"></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form method="GET" action="http://javascript.info/search" class="sitetoolbar__search"><button type="button" class="sitetoolbar__search-toggle"></button><div class="sitetoolbar__search-input"><div class="text-input"><input autofocus name="query" placeholder="Search on Javascript.info" class="text-input__control" type="text"></div><button type="submit" class="sitetoolbar__find">Search</button></div></form></div></div></div><!-- todo: en variant--><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select onchange="if(this.value) window.location.href=this.value" class="input-select input-select_small tablet-menu__nav"><option value="/tutorial" selected>Tutorial</option><option value="/courses">Courses</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form action="http://javascript.info/search/" class="tablet-menu-search"><input type="search" name="query" placeholder="Search in the tutorial" required class="tablet-menu-search__input"><button type="submit" name="type" value="articles" class="tablet-menu-search__button">Search</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div><!--+e.line--><!--  +e.content--><!--    +b("a").tablet-ebook(href="/ebook")--><!--      +e("span").text Купить учебник--><!--      +e("span").note (EPUB + PDF)--><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_fb"></a><a href="https://plus.google.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_vk"></a></div></div></div></div><progress data-sticky value="51" max="67" data-tooltip="Lesson 51 of 67" class="tutorial-progress"></progress></div><div class="page page_sidebar_on"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1" class="breadcrumbs__item breadcrumbs__item_home"><a href="index.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title" class="breadcrumbs__hidden-text">Tutorial</span></a></li><li id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-2" itemprop="child" class="breadcrumbs__item"><a href="js.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">The JavaScript language</span></a></li><li id="breadcrumb-2" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="breadcrumbs__item"><a href="advanced-functions.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">Advanced working with functions</span></a></li></ol><h1 class="main__header-title">Decorators and forwarding, call/apply</h1></div></header><div class="content"><article itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Decorators and forwarding, call/apply"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>JavaScript gives exceptional flexibility when dealing with functions. They can be passed around, used as objects, and now we’ll see how to <em>forward</em> calls between them and <em>decorate</em> them.</p>
<h2><a class="main__anchor" name="transparent-caching" href="#transparent-caching">Transparent caching</a></h2><p>Let’s say we have a function <code>slow(x)</code> which is CPU-heavy, but its results are stable. In other words, for the same <code>x</code> it always returns the same result.</p>
<p>If the function is called often, we may want to cache (remember) the results for different <code>x</code> to avoid spending extra-time on recalculations.</p>
<p>But instead of adding that functionality into <code>slow()</code> we’ll create a wrapper. As we’ll see, there are many benefits of doing so.</p>
<p>Here’s the code, and explanations follow:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function slow(x) {
  // there can be a heavy CPU-intensive job here
  alert(`Called with ${x}`);
  return x;
}

function cachingDecorator(func) {
  let cache = new Map();

  return function(x) {
    if (cache.has(x)) { // if the result is in the map
      return cache.get(x); // return it
    }

    let result = func(x); // otherwise call func

    cache.set(x, result); // and cache (remember) the result
    return result;
  };
}

slow = cachingDecorator(slow);

alert( slow(1) ); // slow(1) is cached
alert( &quot;Again: &quot; + slow(1) ); // the same

alert( slow(2) ); // slow(2) is cached
alert( &quot;Again: &quot; + slow(2) ); // the same as the previous line</code></pre>
        </div>
      </div>
      
      </div><p>In the code above <code>cachingDecorator</code> is a <em>decorator</em>: a special function that takes another function and alters its behavior.</p>
<p>The idea is that we can call <code>cachingDecorator</code> for any function, and it will return the caching wrapper. That’s great, because we can have many functions that could use such a feature, and all we need to do is to apply <code>cachingDecorator</code> to them.</p>
<p>By separating caching from the main function code we also keep the main code simpler.</p>
<p>Now let’s get into details of how it works.</p>
<p>The result of <code>cachingDecorator(func)</code> is a “wrapper”: <code>function(x)</code> that “wraps” the call of <code>func(x)</code> into caching logic:</p>
<figure><div class="image" style="width:417px">
      <div class="image__ratio" style="padding-top:56.35491606714629%"></div>
      <img src="article/call-apply-decorators/decorator-makecaching-wrapper.png" alt="" width="417" height="235" class="image__image">
      </div></figure><p>As we can see, the wrapper returns the result of <code>func(x)</code> “as is”. From an outside code, the wrapped <code>slow</code> function still does the same. It just got a caching aspect added to its behavior.</p>
<p>To summarize, there are several benefits of using a separate <code>cachingDecorator</code> instead of altering the code of <code>slow</code> itself:</p>
<ul>
<li>The <code>cachingDecorator</code> is reusable. We can apply it to another function.</li>
<li>The caching logic is separate, it did not increase the complexity of <code>slow</code> itself (if there were any).</li>
<li>We can combine multiple decorators if needed (other decorators will follow).</li>
</ul>
<h2><a class="main__anchor" name="using-func-call-for-the-context" href="#using-func-call-for-the-context">Using “func.call” for the context</a></h2><p>The caching decorator mentioned above is not suited to work with object methods.</p>
<p>For instance, in the code below <code>worker.slow()</code> stops working after the decoration:</p>
<div data-trusted="1" class="code-example" data-highlight-block="20-20,30-30">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// we'll make worker.slow caching
let worker = {
  someMethod() {
    return 1;
  },

  slow(x) {
    // actually, there can be a scary CPU-heavy task here
    alert(&quot;Called with &quot; + x);
    return x * this.someMethod(); // (*)
  }
};

// same code as before
function cachingDecorator(func) {
  let cache = new Map();
  return function(x) {
    if (cache.has(x)) {
      return cache.get(x);
    }
    let result = func(x); // (**)
    cache.set(x, result);
    return result;
  };
}

alert( worker.slow(1) ); // the original method works

worker.slow = cachingDecorator(worker.slow); // now make it caching

alert( worker.slow(2) ); // Whoops! Error: Cannot read property 'someMethod' of undefined</code></pre>
        </div>
      </div>
      
      </div><p>The error occurs in the line <code>(*)</code> that tries to access <code>this.someMethod</code> and fails. Can you see why?</p>
<p>The reason is that the wrapper calls the original function as <code>func(x)</code> in the line <code>(**)</code>. And, when called like that, the function gets <code>this = undefined</code>.</p>
<p>We would observe a similar symptom if we tried to run:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let func = worker.slow;
func(2);</code></pre>
        </div>
      </div>
      
      </div><p>So, the wrapper passes the call to the original method, but without the context <code>this</code>. Hence the error.</p>
<p>Let’s fix it.</p>
<p>There’s a special built-in function method <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">func.call(context, …args)</a> that allows to call a function explicitly setting <code>this</code>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func.call(context, arg1, arg2, ...)</code></pre>
        </div>
      </div>
      
      </div><p>It runs <code>func</code> providing the first argument as <code>this</code>, and the next as the arguments.</p>
<p>To put it simply, these two calls do almost the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func(1, 2, 3);
func.call(obj, 1, 2, 3)</code></pre>
        </div>
      </div>
      
      </div><p>They both call <code>func</code> with arguments <code>1</code>, <code>2</code> and <code>3</code>. The only difference is that <code>func.call</code> also sets <code>this</code> to <code>obj</code>.</p>
<p>As an example, in the code below we call <code>sayHi</code> in the context of different objects: <code>sayHi.call(user)</code> runs <code>sayHi</code> providing <code>this=user</code>, and the next line sets <code>this=admin</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function sayHi() {
  alert(this.name);
}

let user = { name: &quot;John&quot; };
let admin = { name: &quot;Admin&quot; };

// use call to pass different objects as &quot;this&quot;
sayHi.call( user ); // this = John
sayHi.call( admin ); // this = Admin</code></pre>
        </div>
      </div>
      
      </div><p>And here we use <code>call</code> to call <code>say</code> with the given context and phrase:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function say(phrase) {
  alert(this.name + ': ' + phrase);
}

let user = { name: &quot;John&quot; };

// user becomes this, and &quot;Hello&quot; becomes the first argument
say.call( user, &quot;Hello&quot; ); // John: Hello</code></pre>
        </div>
      </div>
      
      </div><p>In our case, we can use <code>call</code> in the wrapper to pass the context to the original function:</p>
<div data-trusted="1" class="code-example" data-highlight-block="17-17">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  someMethod() {
    return 1;
  },

  slow(x) {
    alert(&quot;Called with &quot; + x);
    return x * this.someMethod(); // (*)
  }
};

function cachingDecorator(func) {
  let cache = new Map();
  return function(x) {
    if (cache.has(x)) {
      return cache.get(x);
    }
    let result = func.call(this, x); // &quot;this&quot; is passed correctly now
    cache.set(x, result);
    return result;
  };
}

worker.slow = cachingDecorator(worker.slow); // now make it caching

alert( worker.slow(2) ); // works
alert( worker.slow(2) ); // works, doesn't call the original (cached)</code></pre>
        </div>
      </div>
      
      </div><p>Now everything is fine.</p>
<p>To make it all clear, let’s see more deeply how <code>this</code> is passed along:</p>
<ol>
<li>After the decoration <code>worker.slow</code> is now the wrapper <code>function (x) { ... }</code>.</li>
<li>So when <code>worker.slow(2)</code> is executed, the wrapper gets <code>2</code> as an argument and <code>this=worker</code> (it’s the object before dot).</li>
<li>Inside the wrapper, assuming the result is not yet cached, <code>func.call(this, x)</code> passes the current <code>this</code> (<code>=worker</code>) and the current argument (<code>=2</code>) to the original method.</li>
</ol>
<h2><a class="main__anchor" name="going-multi-argument-with-func-apply" href="#going-multi-argument-with-func-apply">Going multi-argument with “func.apply”</a></h2><p>Now let’s make <code>cachingDecorator</code> even more universal. Till now it was working only with single-argument functions.</p>
<p>Now how to cache the multi-argument <code>worker.slow</code> method?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  slow(min, max) {
    return min + max; // scary CPU-hogger is assumed
  }
};

// should remember same-argument calls
worker.slow = cachingDecorator(worker.slow);</code></pre>
        </div>
      </div>
      
      </div><p>We have two tasks to solve here.</p>
<p>First is how to use both arguments <code>min</code> and <code>max</code> for the key in <code>cache</code> map. Previously, for a single argument <code>x</code> we could just <code>cache.set(x, result)</code> to save the result and <code>cache.get(x)</code> to retrieve it. But now we need to remember the result for a <em>combination of arguments</em> <code>(min,max)</code>. The native <code>Map</code> takes single value only as the key.</p>
<p>There are many solutions possible:</p>
<ol>
<li>Implement a new (or use a third-party) map-like data structure that is more versatile and allows multi-keys.</li>
<li>Use nested maps: <code>cache.set(min)</code> will be a <code>Map</code> that stores the pair <code>(max, result)</code>. So we can get <code>result</code> as <code>cache.get(min).get(max)</code>.</li>
<li>Join two values into one. In our particular case we can just use a string <code>&quot;min,max&quot;</code> as the <code>Map</code> key. For flexibility, we can allow to provide a <em>hashing function</em> for the decorator, that knows how to make one value from many.</li>
</ol>
<p>For many practical applications, the 3rd variant is good enough, so we’ll stick to it.</p>
<p>The second task to solve is how to pass many arguments to <code>func</code>. Currently, the wrapper <code>function(x)</code> assumes a single argument, and <code>func.call(this, x)</code> passes it.</p>
<p>Here we can use another built-in method <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">func.apply</a>.</p>
<p>The syntax is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func.apply(context, args)</code></pre>
        </div>
      </div>
      
      </div><p>It runs the <code>func</code> setting <code>this=context</code> and using an array-like object <code>args</code> as the list of arguments.</p>
<p>For instance, these two calls are almost the same:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">func(1, 2, 3);
func.apply(context, [1, 2, 3])</code></pre>
        </div>
      </div>
      
      </div><p>Both run <code>func</code> giving it arguments <code>1,2,3</code>. But <code>apply</code> also sets <code>this=context</code>.</p>
<p>For instance, here <code>say</code> is called with <code>this=user</code> and <code>messageData</code> as a list of arguments:</p>
<div data-trusted="1" class="code-example" data-highlight-block="8-9">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function say(time, phrase) {
  alert(`[${time}] ${this.name}: ${phrase}`);
}

let user = { name: &quot;John&quot; };

let messageData = ['10:00', 'Hello']; // become time and phrase

// user becomes this, messageData is passed as a list of arguments (time, phrase)
say.apply(user, messageData); // [10:00] John: Hello (this=user)</code></pre>
        </div>
      </div>
      
      </div><p>The only syntax difference between <code>call</code> and <code>apply</code> is that <code>call</code> expects a list of arguments, while <code>apply</code> takes an array-like object with them.</p>
<p>We already know the spread operator <code>...</code> from the chapter <a href="rest-parameters-spread-operator.html">Rest parameters and spread operator</a> that can pass an array (or any iterable) as a list of arguments. So if we use it with <code>call</code>, we can achieve almost the same as <code>apply</code>.</p>
<p>These two calls are almost equivalent:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let args = [1, 2, 3];

func.call(context, ...args); // pass an array as list with spread operator
func.apply(context, args);   // is same as using apply</code></pre>
        </div>
      </div>
      
      </div><p>If we look more closely, there’s a minor difference between such uses of <code>call</code> and <code>apply</code>.</p>
<ul>
<li>The spread operator <code>...</code> allows to pass <em>iterable</em> <code>args</code> as the list to <code>call</code>.</li>
<li>The <code>apply</code> accepts only <em>array-like</em> <code>args</code>.</li>
</ul>
<p>So, these calls complement each other. Where we expect an iterable, <code>call</code> works, where we expect an array-like, <code>apply</code> works.</p>
<p>And if <code>args</code> is both iterable and array-like, like a real array, then we technically could use any of them, but <code>apply</code> will probably be faster, because it’s a single operation. Most JavaScript engines internally optimize is better than a pair <code>call + spread</code>.</p>
<p>One of the most important uses of <code>apply</code> is passing the call to another function, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let wrapper = function() {
  return anotherFunction.apply(this, arguments);
};</code></pre>
        </div>
      </div>
      
      </div><p>That’s called <em>call forwarding</em>. The <code>wrapper</code> passes everything it gets: the context <code>this</code> and arguments to <code>anotherFunction</code> and returns back its result.</p>
<p>When an external code calls such <code>wrapper</code>, it is indistinguishable from the call of the original function.</p>
<p>Now let’s bake it all into the more powerful <code>cachingDecorator</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="10-10,15-15">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let worker = {
  slow(min, max) {
    alert(`Called with ${min},${max}`);
    return min + max;
  }
};

function cachingDecorator(func, hash) {
  let cache = new Map();
  return function() {
    let key = hash(arguments); // (*)
    if (cache.has(key)) {
      return cache.get(key);
    }

    let result = func.apply(this, arguments); // (**)

    cache.set(key, result);
    return result;
  };
}

function hash(args) {
  return args[0] + ',' + args[1];
}

worker.slow = cachingDecorator(worker.slow, hash);

alert( worker.slow(3, 5) ); // works
alert( &quot;Again &quot; + worker.slow(3, 5) ); // same (cached)</code></pre>
        </div>
      </div>
      
      </div><p>Now the wrapper operates with any number of arguments.</p>
<p>There are two changes:</p>
<ul>
<li>In the line <code>(*)</code> it calls <code>hash</code> to create a single key from <code>arguments</code>. Here we use a simple “joining” function that turns arguments <code>(3, 5)</code> into the key <code>&quot;3,5&quot;</code>. More complex cases may require other hashing functions.</li>
<li>Then <code>(**)</code> uses <code>func.apply</code> to pass both the context and all arguments the wrapper got (no matter how many) to the original function.</li>
</ul>
<h2><a class="main__anchor" name="method-borrowing" href="#method-borrowing">Borrowing a method</a></h2><p>Now let’s make one more minor improvement in the hashing function:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash(args) {
  return args[0] + ',' + args[1];
}</code></pre>
        </div>
      </div>
      
      </div><p>As of now, it works only on two arguments. It would be better if it could glue any number of <code>args</code>.</p>
<p>The natural solution would be to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join">arr.join</a> method:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash(args) {
  return args.join();
}</code></pre>
        </div>
      </div>
      
      </div><p>…Unfortunately, that won’t work. Because we are calling <code>hash(arguments)</code> and <code>arguments</code> object is both iterable and array-like, but not a real array.</p>
<p>So calling <code>join</code> on it would fail, as we can see below:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash() {
  alert( arguments.join() ); // Error: arguments.join is not a function
}

hash(1, 2);</code></pre>
        </div>
      </div>
      
      </div><p>Still, there’s an easy way to use array join:</p>
<div data-trusted="1" class="code-example" data-highlight-block="1-1">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function hash() {
  alert( [].join.call(arguments) ); // 1,2
}

hash(1, 2);</code></pre>
        </div>
      </div>
      
      </div><p>The trick is called <em>method borrowing</em>.</p>
<p>We take (borrow) a join method from a regular array <code>[].join</code>. And use <code>[].join.call</code> to run it in the context of <code>arguments</code>.</p>
<p>Why does it work?</p>
<p>That’s because the internal algorithm of the native method <code>arr.join(glue)</code> is very simple.</p>
<p>Taken from the specification almost “as-is”:</p>
<ol>
<li>Let <code>glue</code> be the first argument or, if no arguments, then a comma <code>&quot;,&quot;</code>.</li>
<li>Let <code>result</code> be an empty string.</li>
<li>Append <code>this[0]</code> to <code>result</code>.</li>
<li>Append <code>glue</code> and <code>this[1]</code>.</li>
<li>Append <code>glue</code> and <code>this[2]</code>.</li>
<li>…Do so until <code>this.length</code> items are glued.</li>
<li>Return <code>result</code>.</li>
</ol>
<p>So, technically it takes <code>this</code> and joins <code>this[0]</code>, <code>this[1]</code> …etc together. It’s intentionally written in a way that allows any array-like <code>this</code> (not a coincidence, many methods follow this practice). That’s why it also works with <code>this=arguments</code>.</p>
<h2><a class="main__anchor" name="summary" href="#summary">Summary</a></h2><p><em>Decorator</em> is a wrapper around a function that alters its behavior. The main job is still carried out by the function.</p>
<p>It is generally safe to replace a function or a method with a decorated one, except for one little thing. If the original function had properties on it, like <code>func.calledCount</code> or whatever, then the decorated one will not provide them. Because that is a wrapper. So one needs to be careful if one uses them. Some decorators provide their own properties.</p>
<p>Decorators can be seen as “features” or “aspects” that can be added to a function. We can add one or add many. And all this without changing its code!</p>
<p>To implement <code>cachingDecorator</code>, we studied methods:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">func.call(context, arg1, arg2…)</a> – calls <code>func</code> with given context and arguments.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">func.apply(context, args)</a> – calls <code>func</code> passing <code>context</code> as <code>this</code> and array-like <code>args</code> into a list of arguments.</li>
</ul>
<p>The generic <em>call forwarding</em> is usually done with <code>apply</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let wrapper = function() {
  return original.apply(this, arguments);
}</code></pre>
        </div>
      </div>
      
      </div><p>We also saw an example of <em>method borrowing</em> when we take a method from an object and <code>call</code> it in the context of another object. It is quite common to take array methods and apply them to arguments. The alternative is to use rest parameters object that is a real array.</p>
<p>There are many decorators there in the wild. Check how well you got them by solving the tasks of this chapter.</p>
</div></article><div class="tasks"><h2 id="tasks" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#spy-decorator" name="spy-decorator" class="main__anchor">Spy decorator</a></h3><a href="task/spy-decorator.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a decorator <code>spy(func)</code> that should return a wrapper that saves all calls to function in its <code>calls</code> property.</p>
<p>Every call is saved as an array of arguments.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function work(a, b) {
  alert( a + b ); // work is an arbitrary function or method
}

work = spy(work);

work(1, 2); // 3
work(4, 5); // 9

for (let args of work.calls) {
  alert( 'call:' + args.join() ); // &quot;call:1,2&quot;, &quot;call:4,5&quot;
}</code></pre>
        </div>
      </div>
      
      </div><p>P.S. That decorator is sometimes useful for unit-testing, it’s advanced form is <code>sinon.spy</code> in <a href="http://sinonjs.org/">Sinon.JS</a> library.</p>
<p><a href="http://plnkr.co/edit/lhWp4nwKXVzY71INg3xi?p=preview" target="_blank" data-plunk-id="lhWp4nwKXVzY71INg3xi">Open the sandbox with tests.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p>Here we can use <code>calls.push(args)</code> to store all arguments in the log and <code>f.apply(this, args)</code> to forward the call.</p>
<p><a href="http://plnkr.co/edit/T9MGSQTejthpWlyjVp6o?p=preview" target="_blank" data-plunk-id="T9MGSQTejthpWlyjVp6o">Open the solution with tests in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#delaying-decorator" name="delaying-decorator" class="main__anchor">Delaying decorator</a></h3><a href="task/delay.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a decorator <code>delay(f, ms)</code> that delays each call of <code>f</code> by <code>ms</code> milliseconds.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(x) {
  alert(x);
}

// create wrappers
let f1000 = delay(f, 1000);
let f1500 = delay(f, 1500);

f1000(&quot;test&quot;); // shows &quot;test&quot; after 1000ms
f1500(&quot;test&quot;); // shows &quot;test&quot; after 1500ms</code></pre>
        </div>
      </div>
      
      </div><p>In other words, <code>delay(f, ms)</code> returns a &quot;delayed by <code>ms</code>&quot; variant of <code>f</code>.</p>
<p>In the code above, <code>f</code> is a function of a single argument, but your solution should pass all arguments and the context <code>this</code>.</p>
<p><a href="http://plnkr.co/edit/UVmZPkd5ITf2gaNi8zFU?p=preview" target="_blank" data-plunk-id="UVmZPkd5ITf2gaNi8zFU">Open the sandbox with tests.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p>The solution:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(f, ms) {

  return function() {
    setTimeout(() =&gt; f.apply(this, arguments), ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p>Please note how an arrow function is used here. As we know, arrow functions do not have own <code>this</code> and <code>arguments</code>, so <code>f.apply(this, arguments)</code> takes <code>this</code> and <code>arguments</code> from the wrapper.</p>
<p>If we pass a regular function, <code>setTimeout</code> would call it without arguments and <code>this=window</code> (in-browser), so we’d need to write a bit more code to pass them from the wrapper:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(f, ms) {

  // added variables to pass this and arguments from the wrapper inside setTimeout
  return function(...args) {
    let savedThis = this;
    setTimeout(function() {
      f.apply(savedThis, args);
    }, ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p><a href="http://plnkr.co/edit/wlayJTZDW6ogX9DDLLWN?p=preview" target="_blank" data-plunk-id="wlayJTZDW6ogX9DDLLWN">Open the solution with tests in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#debounce-decorator" name="debounce-decorator" class="main__anchor">Debounce decorator</a></h3><a href="task/debounce.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>The result of <code>debounce(f, ms)</code> decorator should be a wrapper that passes the call to <code>f</code> at maximum once per <code>ms</code> milliseconds.</p>
<p>In other words, when we call a “debounced” function, it guarantees that all other future in the closest <code>ms</code> milliseconds will be ignored.</p>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let f = debounce(alert, 1000);

f(1); // runs immediately
f(2); // ignored

setTimeout( () =&gt; f(3), 100); // ignored ( only 100 ms passed )
setTimeout( () =&gt; f(4), 1100); // runs
setTimeout( () =&gt; f(5), 1500); // ignored (less than 1000 ms from the last run)</code></pre>
        </div>
      </div>
      
      </div><p>In practice <code>debounce</code> is useful for functions that retrieve/update something when we know that nothing new can be done in such a short period of time, so it’s better not to waste resources.</p>
<p><a href="http://plnkr.co/edit/Ed3ThEJSPlHnmyzVtbNr?p=preview" target="_blank" data-plunk-id="Ed3ThEJSPlHnmyzVtbNr">Open the sandbox with tests.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function debounce(f, ms) {

  let isCooldown = false;

  return function() {
    if (isCooldown) return;

    f.apply(this, arguments);

    isCooldown = true;

    setTimeout(() =&gt; isCooldown = false, ms);
  };

}</code></pre>
        </div>
      </div>
      
      </div><p>The call to <code>debounce</code> returns a wrapper. There may be two states:</p>
<ul>
<li><code>isCooldown = false</code> – ready to run.</li>
<li><code>isCooldown = true</code> – waiting for the timeout.</li>
</ul>
<p>In the first call <code>isCooldown</code> is falsy, so the call proceeds, and the state changes to <code>true</code>.</p>
<p>While <code>isCooldown</code> is true, all other calls are ignored.</p>
<p>Then <code>setTimeout</code> reverts it to <code>false</code> after the given delay.</p>
<p><a href="http://plnkr.co/edit/obOFg7WNaf817UlqKLvD?p=preview" target="_blank" data-plunk-id="obOFg7WNaf817UlqKLvD">Open the solution with tests in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#throttle-decorator" name="throttle-decorator" class="main__anchor">Throttle decorator</a></h3><a href="task/throttle.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a “throttling” decorator <code>throttle(f, ms)</code> – that returns a wrapper, passing the call to <code>f</code> at maximum once per <code>ms</code> milliseconds. Those calls that fall into the “cooldown” period, are ignored.</p>
<p><strong>The difference with <code>debounce</code> – if an ignored call is the last during the cooldown, then it executes at the end of the delay.</strong></p>
<p>Let’s check the real-life application to better understand that requirement and to see where it comes from.</p>
<p><strong>For instance, we want to track mouse movements.</strong></p>
<p>In browser we can setup a function to run at every mouse micro-movement and get the pointer location as it moves. During an active mouse usage, this function usually runs very frequently, can be something like 100 times per second (every 10 ms).</p>
<p><strong>The tracking function should update some information on the web-page.</strong></p>
<p>Updating function <code>update()</code> is too heavy to do it on every micro-movement. There is also no sense in making it more often than once per 100ms.</p>
<p>So we’ll assign <code>throttle(update, 100)</code> as the function to run on each mouse move instead of the original <code>update()</code>. The decorator will be called often, but <code>update()</code> will be called at maximum once per 100ms.</p>
<p>Visually, it will look like this:</p>
<ol>
<li>For the first mouse movement the decorated variant passes the call to <code>update</code>. That’s important, the user sees our reaction to his move immediately.</li>
<li>Then as the mouse moves on, until <code>100ms</code> nothing happens. The decorated variant ignores calls.</li>
<li>At the end of <code>100ms</code> – one more <code>update</code> happens with the last coordinates.</li>
<li>Then, finally, the mouse stops somewhere. The decorated variant waits until <code>100ms</code> expire and then runs <code>update</code> runs with last coordinates. So, perhaps the most important, the final mouse coordinates are processed.</li>
</ol>
<p>A code example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function f(a) {
  console.log(a)
};

// f1000 passes calls to f at maximum once per 1000 ms
let f1000 = throttle(f, 1000);

f1000(1); // shows 1
f1000(2); // (throttling, 1000ms not out yet)
f1000(3); // (throttling, 1000ms not out yet)

// when 1000 ms time out...
// ...outputs 3, intermediate value 2 was ignored</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Arguments and the context <code>this</code> passed to <code>f1000</code> should be passed to the original <code>f</code>.</p>
<p><a href="http://plnkr.co/edit/ozIYbxhX5u3MEbIYKhV1?p=preview" target="_blank" data-plunk-id="ozIYbxhX5u3MEbIYKhV1">Open the sandbox with tests.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function throttle(func, ms) {

  let isThrottled = false,
    savedArgs,
    savedThis;

  function wrapper() {

    if (isThrottled) { // (2)
      savedArgs = arguments;
      savedThis = this;
      return;
    }

    func.apply(this, arguments); // (1)

    isThrottled = true;

    setTimeout(function() {
      isThrottled = false; // (3)
      if (savedArgs) {
        wrapper.apply(savedThis, savedArgs);
        savedArgs = savedThis = null;
      }
    }, ms);
  }

  return wrapper;
}</code></pre>
        </div>
      </div>
      
      </div><p>A call to <code>throttle(func, ms)</code> returns <code>wrapper</code>.</p>
<ol>
<li>During the first call, the <code>wrapper</code> just runs <code>func</code> and sets the cooldown state (<code>isThrottled = true</code>).</li>
<li>In this state all calls memorized in <code>savedArgs/savedThis</code>. Please note that both the context and the arguments are equally important and should be memorized. We need them simultaneously to reproduce the call.</li>
<li>…Then after <code>ms</code> milliseconds pass, <code>setTimeout</code> triggers. The cooldown state is removed (<code>isThrottled = false</code>). And if we had ignored calls, then <code>wrapper</code> is executed with last memorized arguments and context.</li>
</ol>
<p>The 3rd step runs not <code>func</code>, but <code>wrapper</code>, because we not only need to execute <code>func</code>, but once again enter the cooldown state and setup the timeout to reset it.</p>
<p><a href="http://plnkr.co/edit/AYeW7SGshsGjxSY68Ycx?p=preview" target="_blank" data-plunk-id="AYeW7SGshsGjxSY68Ycx">Open the solution with tests in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div></div><!--if lang == 'en'--><!--  include /blocks/banner-bottom.en--></div><div class="page__nav-wrap"><a href="settimeout-setinterval.html" data-tooltip="Scheduling: setTimeout and setInterval" class="page__nav page__nav_prev"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Previous lesson</span></a><a href="bind.html" data-tooltip="Function binding" class="page__nav page__nav_next"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Next lesson</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_fb"></a><a href="https://plus.google.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_vk"></a></div><div class="article-tablet-foot__map"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div></div><div id="comments" class="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Comments</a></h2><div class="comments__read-before"><span class="comments__read-before-link">read this before commenting…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>You're welcome to post additions, questions to the articles and answers to them.</li><li>To insert a few words of code, use the <code>&lt;code&gt;</code> tag, for several lines – use <code>&lt;pre&gt;</code>, for more than 10 lines – use a sandbox (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>If you can't understand something in the article – please elaborate.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/javascript.info\/call-apply-decorators","identifier":"\/call-apply-decorators","title":"Decorators and forwarding, call\/apply"}); };</script><script>var disqus_shortname = "javascriptinfo";</script><script>var disqus_enabled = true;</script></main></div><div class="page__sidebar sidebar sidebar_sticky-footer"><button data-sidebar-toggle class="sidebar__toggle"></button><a href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Tutorial map" class="map"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Chapter</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="advanced-functions.html" class="sidebar__link">Advanced working with functions</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Lesson navigation</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#transparent-caching" class="sidebar__link">Transparent caching</a></li><li class="sidebar__navigation-link"><a href="#using-func-call-for-the-context" class="sidebar__link">Using “func.call” for the context</a></li><li class="sidebar__navigation-link"><a href="#going-multi-argument-with-func-apply" class="sidebar__link">Going multi-argument with “func.apply”</a></li><li class="sidebar__navigation-link"><a href="#method-borrowing" class="sidebar__link">Borrowing a method</a></li><li class="sidebar__navigation-link"><a href="#summary" class="sidebar__link">Summary</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#tasks" class="sidebar__link">Tasks (4)</a></li><li class="sidebar__navigation-link"><a href="#comments" class="sidebar__link">Comments</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Share</div><a href="https://twitter.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_tw sidebar__share"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_fb sidebar__share"></a><a href="https://plus.google.com/share?url=http%3A%2F%2Fjavascript.info%2Fcall-apply-decorators" class="share share_gp sidebar__share"></a></div><div class="sidebar__section"><a href="https://github.com/iliakan/javascript-tutorial-en/tree/master/1-js/06-advanced-functions/09-call-apply-decorators/article.md" class="sidebar__link">Edit on Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Ilya Kantor</li><li class="page-footer__item"><a href="about.html#contact-us" class="page-footer__link">contact us</a></li><li class="page-footer__item"><a href="about.html" class="page-footer__link">about the project</a></li><li class="page-footer__item"><a href="https://learn.javascript.ru/" class="page-footer__link">RU</a> / EN</li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li class="page-footer__item">powered by <a rel="nofollow" href="http://nodejs.org/" class="page-footer__link">node.js</a>&nbsp;&amp;&nbsp;<a rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-en" class="page-footer__link">open source</a></li></ul></div></div></body>
<!-- Mirrored from javascript.info/call-apply-decorators by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:49:06 GMT -->
</html>