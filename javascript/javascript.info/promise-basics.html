<!DOCTYPE html><html lang="en">
<!-- Mirrored from javascript.info/promise-basics by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><title itemprop="name">Promise</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="promise-basics.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><!-- favicon the rest--><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="Promise"><meta property="og:image" content="https://javascript.info/img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Promise"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://javascript.info/img/site_preview_en_512x512.png"><link href="pack/styles.b363cbd7204b6ec74a4cbeca7061b31d.css" rel="stylesheet"><link rel="prev" href="callbacks.html"><link rel="next" href="promise-chaining.html"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 32184394;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var n=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),r=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+n+" "+r,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="inite4da.js?5"></script><script src="pack/head.5ac6aee21473ea597203.js" defer></script><script>
function loadScript(src) {
  return new Promise(function(resolve, reject) {
    let script = document.createElement('script');
    script.src = src;

    script.onload = () => resolve(script);
    script.onerror = () => reject(new Error("Script load error: " + src));

    document.head.append(script);
  });
}
</script>
<meta property="og:title" content="Promise"><meta property="og:type" content="article"><script src="pack/tutorial.5ac6aee21473ea597203.js" defer></script><script src="pack/footer.5ac6aee21473ea597203.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Sorry, IE&lt;10 is not supported, please use a newer browser.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div style="display:none" id="notify-en-tutorial" class="notification notification_info notification_top sitetoolbar__notification"><div class="notification__content">The tutorial was recently rewritten from scratch. There may be typos, please use the "Edit on Github" link (in left sidebar in an article, at the bottom) to propose fixes.
Thank you!</div><button title="Close" class="notification__close"></button></div><script>showTopNotification();</script><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a href="index.html" class="sitetoolbar__link sitetoolbar__link_logo"><img src="img/sitetoolbar__logo_en.svg" width="200" class="sitetoolbar__logo sitetoolbar__logo_normal" alt=""><img src="img/sitetoolbar__logo_small_en.svg" width="70" class="sitetoolbar__logo sitetoolbar__logo_small" alt=""><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){var t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button type="button" class="sitetoolbar__nav-toggle"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a href="index.html" class="sitetoolbar__link">Tutorial</a></li><li class="sitetoolbar__section"><a href="courses.html" class="sitetoolbar__link">Courses</a></li></ul></nav><div class="sitetoolbar__book-wrap"><a href="ebook.html" class="buy-book-button"><span class="buy-book-button__extra-text">Buy</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button data-action-login class="sitetoolbar__login sitetoolbar__login_unready"></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form method="GET" action="http://javascript.info/search" class="sitetoolbar__search"><button type="button" class="sitetoolbar__search-toggle"></button><div class="sitetoolbar__search-input"><div class="text-input"><input autofocus name="query" placeholder="Search on Javascript.info" class="text-input__control" type="text"></div><button type="submit" class="sitetoolbar__find">Search</button></div></form></div></div></div><!-- todo: en variant--><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select onchange="if(this.value) window.location.href=this.value" class="input-select input-select_small tablet-menu__nav"><option value="/tutorial" selected>Tutorial</option><option value="/courses">Courses</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form action="http://javascript.info/search/" class="tablet-menu-search"><input type="search" name="query" placeholder="Search in the tutorial" required class="tablet-menu-search__input"><button type="submit" name="type" value="articles" class="tablet-menu-search__button">Search</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div><!--+e.line--><!--  +e.content--><!--    +b("a").tablet-ebook(href="/ebook")--><!--      +e("span").text Купить учебник--><!--      +e("span").note (EPUB + PDF)--><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_vk"></a></div></div></div></div><progress data-sticky value="2" max="5" data-tooltip="Lesson 2 of 5" class="tutorial-progress"></progress></div><div class="page page_sidebar_on"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1" class="breadcrumbs__item breadcrumbs__item_home"><a href="index.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title" class="breadcrumbs__hidden-text">Tutorial</span></a></li><li id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="breadcrumbs__item"><a href="async.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">Promises, async/await</span></a></li></ol><h1 class="main__header-title">Promise</h1></div></header><div class="content"><article itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Promise"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>Imagine that you’re a top singer, and fans ask day and night for your upcoming single.</p>
<p>To get some relief, you promise to send it to them when it’s published. You give your fans a list to which they can subscribe for updates. They can fill in their email addresses, so that when the song becomes available, all subscribed parties instantly receive it. And even if something goes very wrong, say, if plans to publish the song are cancelled, they will still be notified.</p>
<p>Everyone is happy: you, because the people don’t crowd you any more, and fans, because they won’t miss the single.</p>
<p>This is a real-life analogy for things we often have in programming:</p>
<ol>
<li>A “producing code” that does something and takes time. For instance, the code loads a remote script. That’s a “singer”.</li>
<li>A “consuming code” that wants the result of the “producing code” once it’s ready. Many functions  may need that result. These are the “fans”.</li>
<li>A <em>promise</em> is a special JavaScript object that links the “producing code” and the “consuming code” together. In terms of our analogy: this is the “subscription list”. The “producing code” takes whatever time it needs to produce the promised result, and the “promise” makes that result available to all of the subscribed code when it’s ready.</li>
</ol>
<p>The analogy isn’t terribly accurate, because JavaScript promises are more complex than a simple subscription list: they have additional features and limitations. But it’s fine to begin with.</p>
<p>The constructor syntax for a promise object is:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // executor (the producing code, &quot;singer&quot;)
});</code></pre>
        </div>
      </div>
      
      </div><p>The function passed to <code>new Promise</code> is called the <em>executor</em>. When the promise is created, this executor function runs automatically. It contains the producing code, that should eventually produce a result. In terms of the analogy above: the executor is the “singer”.</p>
<p>The resulting <code>promise</code> object has internal properties:</p>
<ul>
<li><code>state</code> — initially “pending”, then changes to either “fulfilled” or “rejected”,</li>
<li><code>result</code> — an arbitrary value of your choosing, initially <code>undefined</code>.</li>
</ul>
<p>When the executor finishes the job, it should call one of the functions that it gets as arguments:</p>
<ul>
<li><code>resolve(value)</code> — to indicate that the job finished successfully:
<ul>
<li>sets <code>state</code> to <code>&quot;fulfilled&quot;</code>,</li>
<li>sets <code>result</code> to <code>value</code>.</li>
</ul>
</li>
<li><code>reject(error)</code> — to indicate that an error occurred:
<ul>
<li>sets <code>state</code> to <code>&quot;rejected&quot;</code>,</li>
<li>sets <code>result</code> to <code>error</code>.</li>
</ul>
</li>
</ul>
<figure><div class="image" style="width:484px">
      <div class="image__ratio" style="padding-top:48.14049586776859%"></div>
      <img src="article/promise-basics/promise-resolve-reject.png" alt="" width="484" height="233" class="image__image">
      </div></figure><p>Later we’ll see how these changes become known to “fans”.</p>
<p>Here’s an example of a Promise constructor and a simple executor function with its “producing code” (the <code>setTimeout</code>):</p>
<div data-trusted="1" class="code-example" data-highlight-inline="4:19-35">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // the function is executed automatically when the promise is constructed

  // after 1 second signal that the job is done with the result &quot;done!&quot;
  setTimeout(() =&gt; resolve(&quot;done!&quot;), 1000);
});</code></pre>
        </div>
      </div>
      
      </div><p>We can see two things by running the code above:</p>
<ol>
<li>The executor is called automatically and immediately (by the <code>new Promise</code>).</li>
<li>The executor receives two arguments: <code>resolve</code> and <code>reject</code> — these functions are pre-defined by the JavaScript engine. So we don’t need to create them. Instead, we should write the executor to call them when ready.</li>
</ol>
<p>After one second of “processing” the executor calls <code>resolve(&quot;done&quot;)</code> to produce the result:</p>
<figure><div class="image" style="width:484px">
      <div class="image__ratio" style="padding-top:16.94214876033058%"></div>
      <img src="article/promise-basics/promise-resolve-1.png" alt="" width="484" height="82" class="image__image">
      </div></figure><p>That was an example of a successful job completion, a “fulfilled promise”.</p>
<p>And now an example of the executor rejecting the promise with an error:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:19-47">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // after 1 second signal that the job is finished with an error
  setTimeout(() =&gt; reject(new Error(&quot;Whoops!&quot;)), 1000);
});</code></pre>
        </div>
      </div>
      
      </div><figure><div class="image" style="width:483px">
      <div class="image__ratio" style="padding-top:16.977225672877847%"></div>
      <img src="article/promise-basics/promise-reject-1.png" alt="" width="483" height="82" class="image__image">
      </div></figure><p>To summarize, the executor should do a job (something that takes time usually) and then call <code>resolve</code> or <code>reject</code> to change the state of the corresponding Promise object.</p>
<p>The Promise that is either resolved or rejected is called “settled”, as opposed to a “pending” Promise.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">There can be only a single result or an error</span></div>
            <div class="important__content"><p>The executor should call only one <code>resolve</code> or <code>reject</code>. The promise’s state change is final.</p>
<p>All further calls of <code>resolve</code> and <code>reject</code> are ignored:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  resolve(&quot;done&quot;);

  reject(new Error(&quot;…&quot;)); // ignored
  setTimeout(() =&gt; resolve(&quot;…&quot;)); // ignored
});</code></pre>
        </div>
      </div>
      
      </div><p>The idea is that a job done by the executor may have only one result or an error.</p>
<p>Further, <code>resolve</code>/<code>reject</code> expect only one argument and will ignore additional arguments.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Reject with <code>Error</code> objects</span></div>
            <div class="important__content"><p>In case if something goes wrong, we can call <code>reject</code> with any type of argument (just like <code>resolve</code>). But it is recommended to use <code>Error</code> objects (or objects that inherit from <code>Error</code>). The reasoning for that will soon become apparent.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Immediately calling <code>resolve</code>/<code>reject</code></span></div>
            <div class="important__content"><p>In practice, an executor usually does something asynchronously and calls <code>resolve</code>/<code>reject</code> after some time, but it doesn’t have to. We also can call <code>resolve</code> or <code>reject</code> immediately, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  // not taking our time to do the job
  resolve(123); // immediately give the result: 123
});</code></pre>
        </div>
      </div>
      
      </div><p>For instance, this might happen when we start to do a job but then see that everything has already been completed.</p>
<p>That’s fine. We immediately have a resolved Promise, nothing wrong with that.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">The <code>state</code> and <code>result</code> are internal</span></div>
            <div class="important__content"><p>The properties <code>state</code> and <code>result</code> of the Promise object are internal. We can’t directly access them from our “consuming code”. We can use the methods <code>.then</code>/<code>.catch</code> for that. They are described below.</p>
</div></div>
<h2><a class="main__anchor" name="consumers-then-and-catch" href="#consumers-then-and-catch">Consumers: “then” and “catch”</a></h2><p>A Promise object serves as a link between the executor (the “producing code” or &quot;singer) and the consuming functions (the “fans”), which will receive the result or error. Consuming functions can be registered (subscribed) using the methods <code>.then</code> and <code>.catch</code>.</p>
<p>The syntax of <code>.then</code> is:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="1:21-53,2:20-41">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">promise.then(
  function(result) { /* handle a successful result */ },
  function(error) { /* handle an error */ }
);</code></pre>
        </div>
      </div>
      
      </div><p>The first argument of <code>.then</code> is a function that:</p>
<ol>
<li>runs when the Promise is resolved, and</li>
<li>receives the result.</li>
</ol>
<p>The second argument of <code>.then</code> is a function that:</p>
<ol>
<li>runs when the Promise is rejected, and</li>
<li>receives the error.</li>
</ol>
<p>For instance, here’s the reaction to a successfuly resolved promise:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-6">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  setTimeout(() =&gt; resolve(&quot;done!&quot;), 1000);
});

// resolve runs the first function in .then
promise.then(
  result =&gt; alert(result), // shows &quot;done!&quot; after 1 second
  error =&gt; alert(error) // doesn't run
);</code></pre>
        </div>
      </div>
      
      </div><p>The first function was executed.</p>
<p>And in the case of a rejection – the second one:</p>
<div data-trusted="1" class="code-example" data-highlight-block="7-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  setTimeout(() =&gt; reject(new Error(&quot;Whoops!&quot;)), 1000);
});

// reject runs the second function in .then
promise.then(
  result =&gt; alert(result), // doesn't run
  error =&gt; alert(error) // shows &quot;Error: Whoops!&quot; after 1 second
);</code></pre>
        </div>
      </div>
      
      </div><p>If we’re interested only in successful completions, then we can provide only one function argument to <code>.then</code>:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-4">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(resolve =&gt; {
  setTimeout(() =&gt; resolve(&quot;done!&quot;), 1000);
});

promise.then(alert); // shows &quot;done!&quot; after 1 second</code></pre>
        </div>
      </div>
      
      </div><p>If we’re interested only in errors, then we can use <code>null</code> as the first argument: <code>.then(null, errorHandlingFunction)</code>. Or we can use <code>.catch(errorHandlingFunction)</code>, which is exactly the same:</p>
<div data-trusted="1" class="code-example" data-highlight-block="4-5">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise((resolve, reject) =&gt; {
  setTimeout(() =&gt; reject(new Error(&quot;Whoops!&quot;)), 1000);
});

// .catch(f) is the same as promise.then(null, f)
promise.catch(alert); // shows &quot;Error: Whoops!&quot; after 1 second</code></pre>
        </div>
      </div>
      
      </div><p>The call <code>.catch(f)</code> is a complete analog of <code>.then(null, f)</code>, it’s just a shorthand.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">On settled promises <code>then</code> runs immediately</span></div>
            <div class="important__content"><p>If a promise is pending, <code>.then/catch</code> handlers wait for the result. Otherwise, if a promise has already settled, they execute immediately:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// an immediately resolved promise
let promise = new Promise(resolve =&gt; resolve(&quot;done!&quot;));

promise.then(alert); // done! (shows up right now)</code></pre>
        </div>
      </div>
      
      </div><p>Some tasks may sometimes require time and sometimes finish immediately. The good thing is: the <code>.then</code> handler is guaranteed to run in both cases.</p>
</div></div>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Handlers of <code>.then</code>/<code>.catch</code> are always asynchronous</span></div>
            <div class="important__content"><p>Even when the Promise is immediately resolved, code which occurs on lines <em>below</em> your <code>.then</code>/<code>.catch</code> may still execute first.</p>
<p>The JavaScript engine has an internal execution queue which gets all <code>.then/catch</code> handlers.</p>
<p>But it only looks into that queue when the current execution is finished.</p>
<p>In other words, <code>.then/catch</code> handlers are pending execution until the engine is done with the current code.</p>
<p>For instance, here:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// an &quot;immediately&quot; resolved Promise
const executor = resolve =&gt; resolve(&quot;done!&quot;);
const promise = new Promise(executor);

promise.then(alert); // this alert shows last (*)

alert(&quot;code finished&quot;); // this alert shows first</code></pre>
        </div>
      </div>
      
      </div><p>The promise becomes settled immediately, but the engine first finishes the current code, calls <code>alert</code>, and only <em>afterwards</em> looks into the queue to run <code>.then</code> handler.</p>
<p>So the code <em>after</em> <code>.then</code> ends up always running <em>before</em> the Promise’s subscribers, even in the case of an immediately-resolved Promise.</p>
<p>Usually that’s unimportant, but in some scenarios the order may matter a great deal.</p>
</div></div>
<p>Next, let’s see more practical examples of how promises can help us to write asynchronous code.</p>
<h2><a class="main__anchor" name="example-loadscript" href="#example-loadscript">Example: loadScript</a></h2><p>We’ve got the <code>loadScript</code> function for loading a script from the previous chapter.</p>
<p>Here’s the callback-based variant, just to remind us of it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () =&gt; callback(null, script);
  script.onerror = () =&gt; callback(new Error(`Script load error ` + src));

  document.head.append(script);
}</code></pre>
        </div>
      </div>
      
      </div><p>Let’s rewrite it using Promises.</p>
<p>The new function <code>loadScript</code> will not require a callback. Instead, it will create and return a Promise object that resolves when the loading is complete. The outer code can add handlers (subscribing functions) to it using <code>.then</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function loadScript(src) {
  return new Promise(function(resolve, reject) {
    let script = document.createElement('script');
    script.src = src;

    script.onload = () =&gt; resolve(script);
    script.onerror = () =&gt; reject(new Error(&quot;Script load error: &quot; + src));

    document.head.append(script);
  });
}</code></pre>
        </div>
      </div>
      
      </div><p>Usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = loadScript(&quot;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.2.0/lodash.js&quot;);

promise.then(
  script =&gt; alert(`${script.src} is loaded!`),
  error =&gt; alert(`Error: ${error.message}`)
);

promise.then(script =&gt; alert('One more handler to do something else!'));</code></pre>
        </div>
      </div>
      
      </div><p>We can immediately see a few benefits over the callback-based pattern:</p>
<div class="balance"><div class="balance__minuses">
      <div class="balance__content">
      <div class="balance__title">Callbacks</div><ul class="balance__list"><li>We must have a ready <code>callback</code> function when calling <code>loadScript</code>. In other words, we must know what to do with the result <em>before</em> <code>loadScript</code> is called.</li>
<li>There can be only one callback.</li>
</ul></div></div><div class="balance__pluses">
      <div class="balance__content">
      <div class="balance__title">Promises</div><ul class="balance__list"><li>Promises allow us to do things in the natural order. First, we run <code>loadScript</code>, and <code>.then</code> we write what to do with the result.</li>
<li>We can call <code>.then</code> on a Promise as many times as we want. Each time, we’re adding a new “fan”, a new subscribing function, to the “subscription list”. More about this in the next section: <a href="promise-chaining.html">Promise Chaining</a>.</li>
</ul></div></div></div><p>So Promises already give us better code flow and flexibility. But there’s more. We’ll see that in the next chapters.</p>
</div></article><div class="tasks"><h2 id="tasks" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#re-resolve-a-promise" name="re-resolve-a-promise" class="main__anchor">Re-resolve a promise?</a></h3><a href="task/re-resolve.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>What’s the output of the code below?</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let promise = new Promise(function(resolve, reject) {
  resolve(1);

  setTimeout(() =&gt; resolve(2), 1000);
});

promise.then(alert);</code></pre>
        </div>
      </div>
      
      </div><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p>The output is: <code>1</code>.</p>
<p>The second call to <code>resolve</code> is ignored, because only the first call of <code>reject/resolve</code> is taken into account. Further calls are ignored.</p>
</div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#delay-with-a-promise" name="delay-with-a-promise" class="main__anchor">Delay with a promise</a></h3><a href="task/delay-promise.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>The built-in function <code>setTimeout</code> uses callbacks. Create a promise-based alternative.</p>
<p>The function <code>delay(ms)</code> should return a promise. That promise should resolve after <code>ms</code> milliseconds, so that we can add <code>.then</code> to it, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(ms) {
  // your code
}

delay(3000).then(() =&gt; alert('runs after 3 seconds'));</code></pre>
        </div>
      </div>
      
      </div><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function delay(ms) {
  return new Promise(resolve =&gt; setTimeout(resolve, ms));
}

delay(3000).then(() =&gt; alert('runs after 3 seconds'));</code></pre>
        </div>
      </div>
      
      </div><p>Please note that in this task <code>resolve</code> is called without arguments. We don’t return any value from <code>delay</code>, just ensure the delay.</p>
</div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#animated-circle-with-promise" name="animated-circle-with-promise" class="main__anchor">Animated circle with promise</a></h3><a href="task/animate-circle-promise.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"></div><div class="task__content"><p>Rewrite the <code>showCircle</code> function in the solution of the task <a href="task/animate-circle-callback.html">Animated circle with callback</a> so that it returns a promise instead of accepting a callback.</p>
<p>The new usage:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">showCircle(150, 150, 100).then(div =&gt; {
  div.classList.add('message-ball');
  div.append(&quot;Hello, world!&quot;);
});</code></pre>
        </div>
      </div>
      
      </div><p>Take the solution of the task <a href="task/animate-circle-callback.html">Animated circle with callback</a> as the base.</p>
<button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p><a href="http://plnkr.co/edit/QrcbgN2Suiz8HFp5DsbE?p=preview" target="_blank" data-plunk-id="QrcbgN2Suiz8HFp5DsbE">Open the solution in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div></div><!--if lang == 'en'--><!--  include /blocks/banner-bottom.en--></div><div class="page__nav-wrap"><a href="callbacks.html" data-tooltip="Introduction: callbacks" class="page__nav page__nav_prev"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Previous lesson</span></a><a href="promise-chaining.html" data-tooltip="Promises chaining" class="page__nav page__nav_next"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Next lesson</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_vk"></a></div><div class="article-tablet-foot__map"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div></div><div id="comments" class="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Comments</a></h2><div class="comments__read-before"><span class="comments__read-before-link">read this before commenting…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>You're welcome to post additions, questions to the articles and answers to them.</li><li>To insert a few words of code, use the <code>&lt;code&gt;</code> tag, for several lines – use <code>&lt;pre&gt;</code>, for more than 10 lines – use a sandbox (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>If you can't understand something in the article – please elaborate.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/javascript.info\/promise-basics","identifier":"\/promise-basics","title":"Promise"}); };</script><script>var disqus_shortname = "javascriptinfo";</script><script>var disqus_enabled = true;</script></main></div><div class="page__sidebar sidebar sidebar_sticky-footer"><button data-sidebar-toggle class="sidebar__toggle"></button><a href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Tutorial map" class="map"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Chapter</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="async.html" class="sidebar__link">Promises, async/await</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Lesson navigation</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#consumers-then-and-catch" class="sidebar__link">Consumers: “then” and “catch”</a></li><li class="sidebar__navigation-link"><a href="#example-loadscript" class="sidebar__link">Example: loadScript</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#tasks" class="sidebar__link">Tasks (3)</a></li><li class="sidebar__navigation-link"><a href="#comments" class="sidebar__link">Comments</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Share</div><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_tw sidebar__share"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_fb sidebar__share"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fpromise-basics" class="share share_gp sidebar__share"></a></div><div class="sidebar__section"><a href="https://github.com/iliakan/javascript-tutorial-en/tree/master/6-async/02-promise-basics/article.md" class="sidebar__link">Edit on Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Ilya Kantor</li><li class="page-footer__item"><a href="about.html#contact-us" class="page-footer__link">contact us</a></li><li class="page-footer__item"><a href="about.html" class="page-footer__link">about the project</a></li><li class="page-footer__item"><a href="https://learn.javascript.ru/" class="page-footer__link">RU</a> / EN</li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li class="page-footer__item">powered by <a rel="nofollow" href="http://nodejs.org/" class="page-footer__link">node.js</a>&nbsp;&amp;&nbsp;<a rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-en" class="page-footer__link">open source</a></li></ul></div></div></body>
<!-- Mirrored from javascript.info/promise-basics by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:37 GMT -->
</html>