<!DOCTYPE html><html lang="en">
<!-- Mirrored from javascript.info/cross-window-communication by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><title itemprop="name">Cross-window communication</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="cross-window-communication.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><!-- favicon the rest--><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="Cross-window communication"><meta property="og:image" content="https://javascript.info/img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Cross-window communication"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://javascript.info/img/site_preview_en_512x512.png"><link href="pack/styles.b363cbd7204b6ec74a4cbeca7061b31d.css" rel="stylesheet"><link rel="prev" href="popup-windows.html"><link rel="next" href="clickjacking.html"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 32184394;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var n=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),r=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+n+" "+r,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="inite4da.js?5"></script><script src="pack/head.5ac6aee21473ea597203.js" defer></script><meta property="og:title" content="Cross-window communication"><meta property="og:type" content="article"><script src="pack/tutorial.5ac6aee21473ea597203.js" defer></script><script src="pack/footer.5ac6aee21473ea597203.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Sorry, IE&lt;10 is not supported, please use a newer browser.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div style="display:none" id="notify-en-tutorial" class="notification notification_info notification_top sitetoolbar__notification"><div class="notification__content">The tutorial was recently rewritten from scratch. There may be typos, please use the "Edit on Github" link (in left sidebar in an article, at the bottom) to propose fixes.
Thank you!</div><button title="Close" class="notification__close"></button></div><script>showTopNotification();</script><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a href="index.html" class="sitetoolbar__link sitetoolbar__link_logo"><img src="img/sitetoolbar__logo_en.svg" width="200" class="sitetoolbar__logo sitetoolbar__logo_normal" alt=""><img src="img/sitetoolbar__logo_small_en.svg" width="70" class="sitetoolbar__logo sitetoolbar__logo_small" alt=""><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){var t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button type="button" class="sitetoolbar__nav-toggle"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a href="index.html" class="sitetoolbar__link">Tutorial</a></li><li class="sitetoolbar__section"><a href="courses.html" class="sitetoolbar__link">Courses</a></li></ul></nav><div class="sitetoolbar__book-wrap"><a href="ebook.html" class="buy-book-button"><span class="buy-book-button__extra-text">Buy</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button data-action-login class="sitetoolbar__login sitetoolbar__login_unready"></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form method="GET" action="http://javascript.info/search" class="sitetoolbar__search"><button type="button" class="sitetoolbar__search-toggle"></button><div class="sitetoolbar__search-input"><div class="text-input"><input autofocus name="query" placeholder="Search on Javascript.info" class="text-input__control" type="text"></div><button type="submit" class="sitetoolbar__find">Search</button></div></form></div></div></div><!-- todo: en variant--><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select onchange="if(this.value) window.location.href=this.value" class="input-select input-select_small tablet-menu__nav"><option value="/tutorial" selected>Tutorial</option><option value="/courses">Courses</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form action="http://javascript.info/search/" class="tablet-menu-search"><input type="search" name="query" placeholder="Search in the tutorial" required class="tablet-menu-search__input"><button type="submit" name="type" value="articles" class="tablet-menu-search__button">Search</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div><!--+e.line--><!--  +e.content--><!--    +b("a").tablet-ebook(href="/ebook")--><!--      +e("span").text Купить учебник--><!--      +e("span").note (EPUB + PDF)--><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_vk"></a></div></div></div></div><progress data-sticky value="2" max="3" data-tooltip="Lesson 2 of 3" class="tutorial-progress"></progress></div><div class="page page_sidebar_on"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1" class="breadcrumbs__item breadcrumbs__item_home"><a href="index.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title" class="breadcrumbs__hidden-text">Tutorial</span></a></li><li id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="breadcrumbs__item"><a href="frames-and-windows.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">Frames and windows</span></a></li></ol><h1 class="main__header-title">Cross-window communication</h1></div></header><div class="content"><article itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Cross-window communication"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>The “Same Origin” (same site) policy limits access of windows and frame to each other.</p>
<p>The idea is that if we have two windows open: one from <code>john-smith.com</code>, and another one is <code>gmail.com</code>, then we wouldn’t want a script from <code>john-smith.com</code> to read our mail.</p>
<h2><a class="main__anchor" name="same-origin" href="#same-origin">Same Origin</a></h2><p>Two URLs are said to have the “same origin” if they have the same protocol, domain and port.</p>
<p>These URLs all share the same origin:</p>
<ul>
<li><code>http://site.com</code></li>
<li><code>http://site.com/</code></li>
<li><code>http://site.com/my/page.html</code></li>
</ul>
<p>These ones do not:</p>
<ul>
<li><code>http://<b>www.</b>site.com</code> (another domain: <code>www.</code> matters)</li>
<li><code>http://<b>site.org</b></code> (another domain: <code>.org</code> matters)</li>
<li><code><b>https://</b>site.com</code> (another protocol: <code>https</code>)</li>
<li><code>http://site.com:<b>8080</b></code> (another port: <code>8080</code>)</li>
</ul>
<p>If we have a reference to another window (a popup or iframe), and that window comes from the same origin, then we can do everything with it.</p>
<p>If it comes from another origin, then we can only change its location. Please note: not <em>read</em> the location, but <em>modify</em> it, redirect it to another place. That’s safe, because the URL may contain sensitive parameters, so reading it from another origin is prohibited, but changing is not.</p>
<p>Also such windows may exchange messages. Soon about that later.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">Exclusion: subdomains may be same-origin</span></div>
            <div class="important__content"><p>There’s an important exclusion in the same-origin policy.</p>
<p>If windows share the same second-level domain, for instance <code>john.site.com</code>, <code>peter.site.com</code> and <code>site.com</code>, we can use JavaScript to assign to <code>document.domain</code> their common second-level domain <code>site.com</code>. Then these windows are treated as having the same origin.</p>
<p>In other words, all such documents (including the one from <code>site.com</code>) should have the code:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.domain = 'site.com';</code></pre>
        </div>
      </div>
      
      </div><p>Then they can interact without limitations.</p>
<p>That’s only possible for pages with the same second-level domain.</p>
</div></div>
<h2><a class="main__anchor" name="accessing-an-iframe-contents" href="#accessing-an-iframe-contents">Accessing an iframe contents</a></h2><p>An <code>&lt;iframe&gt;</code> is a two-faced beast. From one side it’s a tag, just like <code>&lt;script&gt;</code> or <code>&lt;img&gt;</code>. From the other side it’s a window-in-window.</p>
<p>The embedded window has a separate <code>document</code> and <code>window</code> objects.</p>
<p>We can access them like using the properties:</p>
<ul>
<li><code>iframe.contentWindow</code> is a reference to the window inside the <code>&lt;iframe&gt;</code>.</li>
<li><code>iframe.contentDocument</code> is a reference to the document inside the <code>&lt;iframe&gt;</code>.</li>
</ul>
<p>When we access an embedded window, the browser checks if the iframe has the same origin. If that’s not so then the access is denied (with exclusions noted above).</p>
<p>For instance, here’s an <code>&lt;iframe&gt;</code> from another origin:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;https://example.com&quot; id=&quot;iframe&quot;&gt;&lt;/iframe&gt;

&lt;script&gt;
  iframe.onload = function() {
    // we can get the reference to the inner window
    let iframeWindow = iframe.contentWindow;

    try {
      // ...but not to the document inside it
      let doc = iframe.contentDocument;
    } catch(e) {
      alert(e); // Security Error (another origin)
    }

    // also we can't read the URL of the page in it
    try {
      alert(iframe.contentWindow.location);
    } catch(e) {
      alert(e); // Security Error
    }

    // ...but we can change it (and thus load something else into the iframe)!
    iframe.contentWindow.location = '/'; // works

    iframe.onload = null; // clear the handler, to run this code only once
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>The code above shows errors for any operations except:</p>
<ul>
<li>Getting the reference to the inner window <code>iframe.contentWindow</code></li>
<li>Changing its <code>location</code>.</li>
</ul>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>iframe.onload</code> vs <code>iframe.contentWindow.onload</code></span></div>
            <div class="important__content"><p>The <code>iframe.onload</code> event is actually the same as <code>iframe.contentWindow.onload</code>. It triggers when the embedded window fully loads with all resources.</p>
<p>…But <code>iframe.onload</code> is always available, while <code>iframe.contentWindow.onload</code> needs the same origin.</p>
</div></div>
<p>And now an example with the same origin. We can do anything with the embedded window:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;/&quot; id=&quot;iframe&quot;&gt;&lt;/iframe&gt;

&lt;script&gt;
  iframe.onload = function() {
    // just do anything
    iframe.contentDocument.body.prepend(&quot;Hello, world!&quot;);
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h3><a class="main__anchor" name="please-wait-until-the-iframe-loads" href="#please-wait-until-the-iframe-loads">Please wait until the iframe loads</a></h3><p>When an iframe is created, it immediately has a document. But that document is different from the one that finally loads into it!</p>
<p>Here, look:</p>
<div data-trusted="1" class="code-example" data-highlight-block="6-7">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;/&quot; id=&quot;iframe&quot;&gt;&lt;/iframe&gt;

&lt;script&gt;
  let oldDoc = iframe.contentDocument;
  iframe.onload = function() {
    let newDoc = iframe.contentDocument;
    // the loaded document is not the same as initial!
    alert(oldDoc == newDoc); // false
  };
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>That’s actually a well-known pitfall for novice developers. We shouldn’t work with the document immediately, because that’s the <em>wrong document</em>. If we set any event handlers on it, they will be ignored.</p>
<p>…But the <code>onload</code> event triggers when the whole iframe with all resources is loaded. What if we want to act sooner, on <code>DOMContentLoaded</code> of the embedded document?</p>
<p>That’s not possible if the iframe comes from another origin. But for the same origin we can try to catch the moment when a new document appears, and then setup necessary handlers, like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;/&quot; id=&quot;iframe&quot;&gt;&lt;/iframe&gt;

&lt;script&gt;
  let oldDoc = iframe.contentDocument;

  // every 100 ms check if the document is the new one
  let timer = setInterval(() =&gt; {
    if (iframe.contentDocument == oldDoc) return;

    // new document, let's set handlers
    iframe.contentDocument.addEventListener('DOMContentLoaded', () =&gt; {
      iframe.contentDocument.body.prepend('Hello, world!');
    });

    clearInterval(timer); // cancel setInterval, don't need it any more
  }, 100);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Let me know in comments if you know a better solution here.</p>
<h2><a class="main__anchor" name="window-frames" href="#window-frames">window.frames</a></h2><p>An alternative way to get a window object for <code>&lt;iframe&gt;</code> – is to get it from the named collection  <code>window.frames</code>:</p>
<ul>
<li>By number: <code>window.frames[0]</code> – the window object for the first frame in the document.</li>
<li>By name: <code>window.frames.iframeName</code> – the window object for the frame with  <code>name=&quot;iframeName&quot;</code>.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;/&quot; style=&quot;height:80px&quot; name=&quot;win&quot; id=&quot;iframe&quot;&gt;&lt;/iframe&gt;

&lt;script&gt;
  alert(iframe.contentWindow == frames[0]); // true
  alert(iframe.contentWindow == frames.win); // true
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>An iframe may have other iframes inside. The corresponding <code>window</code> objects form a hierarchy.</p>
<p>Navigation links are:</p>
<ul>
<li><code>window.frames</code> – the collection of “children” windows (for nested frames).</li>
<li><code>window.parent</code> – the reference to the “parent” (outer) window.</li>
<li><code>window.top</code> – the reference to the topmost parent window.</li>
</ul>
<p>For instance:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.frames[0].parent === window; // true</code></pre>
        </div>
      </div>
      
      </div><p>We can use the <code>top</code> property to check if the current document is open inside a frame or not:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="run" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (window == top) { // current window == window.top?
  alert('The script is in the topmost window, not in a frame');
} else {
  alert('The script runs in a frame!');
}</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="the-sandbox-attribute" href="#the-sandbox-attribute">The sandbox attribute</a></h2><p>The <code>sandbox</code> attribute allows to forbid certain actions inside an <code>&lt;iframe&gt;</code>, to run an untrusted code. It “sandboxes” the iframe by treating it as coming from another origin and/or applying other limitations.</p>
<p>By default, for <code>&lt;iframe sandbox src=&quot;...&quot;&gt;</code> the “default set” of restrictions is applied to the iframe. But we can provide a space-separated list of “excluded” limitations as a value of the attribute, like this: <code>&lt;iframe sandbox=&quot;allow-forms allow-popups&quot;&gt;</code>. The listed limitations are not applied.</p>
<p>In other words, an empty <code>&quot;sandbox&quot;</code> attribute puts the strictest limitations possible, but we can put a space-delimited list of those that we want to lift.</p>
<p>Here’s a list of limitations:</p>
<dl>
<dt><code>allow-same-origin</code></dt>
<dd>By default <code>&quot;sandbox&quot;</code> forces the “different origin” policy for the iframe. In other words, it makes the browser to treat the <code>iframe</code> as coming from another origin, even if its <code>src</code> points to the same site. With all implied restrictions for scripts. This option removes that feature.</dd>
<dt><code>allow-top-navigation</code></dt>
<dd>Allows the <code>iframe</code> to change <code>parent.location</code>.</dd>
<dt><code>allow-forms</code></dt>
<dd>Allows to submit forms from <code>iframe</code>.</dd>
<dt><code>allow-scripts</code></dt>
<dd>Allows to run scripts from the <code>iframe</code>.</dd>
<dt><code>allow-popups</code></dt>
<dd>Allows to <code>window.open</code> popups from the <code>iframe</code></dd>
</dl>
<p>See <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">the manual</a> for more.</p>
<p>The example below demonstrates a sandboxed iframe with the default set of restrictions: <code>&lt;iframe sandbox src=&quot;...&quot;&gt;</code>. It has some JavaScript and a form.</p>
<p>Please note that nothing works. So the default set is really harsh:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left class="code-tabs__scroll-button code-tabs__scroll-button_left"></button></div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">index.html</div><div class="code-tabs__switch">sandboxed.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right class="code-tabs__scroll-button code-tabs__scroll-button_right"></button></div><div class="code-tabs__buttons"><a target="_blank" title="open in a new window" href="article/cross-window-communication/sandbox/index.html" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/M6VMh5GNeahIY1l95Tgt?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content style="height:140px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="article/cross-window-communication/sandbox/index.html" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;div&gt;The iframe below is has &lt;code&gt;sandbox&lt;/code&gt; attribute.&lt;/div&gt;

  &lt;iframe sandbox src=&quot;sandboxed.html&quot; style=&quot;height:60px;width:90%&quot;&gt;&lt;/iframe&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;button onclick=&quot;alert(123)&quot;&gt;Click to run a script (doesn't work)&lt;/button&gt;

  &lt;form action=&quot;http://google.com&quot;&gt;
    &lt;input type=&quot;text&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit (doesn't work)&quot;&gt;
  &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><div class="important important_smart">
            <div class="important__header"><span class="important__type">Please note:</span></div>
            <div class="important__content"><p>The purpose of the <code>&quot;sandbox&quot;</code> attribute is only to <em>add more</em> restrictions. It cannot remove them. In particular, it can’t relax same-origin restrictions if the iframe comes from another origin.</p>
</div></div>
<h2><a class="main__anchor" name="cross-window-messaging" href="#cross-window-messaging">Cross-window messaging</a></h2><p>The <code>postMessage</code> interface allows windows to talk to each other no matter which origin they are from.</p>
<p>It has two parts.</p>
<h3><a class="main__anchor" name="postmessage" href="#postmessage">postMessage</a></h3><p>The window that wants to send a message calls <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">postMessage</a> method of the receiving window. In other words, if we want to send the message to <code>win</code>, we should call  <code>win.postMessage(data, targetOrigin)</code>.</p>
<p>Arguments:</p>
<dl>
<dt><code>data</code></dt>
<dd>The data to send. Can be any object, the data is cloned using the “structured cloning algorithm”. IE supports only strings, so we should <code>JSON.stringify</code> complex objects to support that browser.</dd>
<dt><code>targetOrigin</code></dt>
<dd>Specifies the origin for the target window, so that only a window from the given origin will get the message.</dd>
</dl>
<p>The <code>targetOrigin</code> is a safety measure. Remember, if the target window comes from another origin, we can’t read it’s <code>location</code>. So we can’t be sure which site is open in the intended window right now: the user could navigate away.</p>
<p>Specifying <code>targetOrigin</code> ensures that the window only receives the data if it’s still at that site. Good when the data is sensitive.</p>
<p>For instance, here <code>win</code> will only receive the message if it has a document from the origin <code>http://example.com</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;http://example.com&quot; name=&quot;example&quot;&gt;

&lt;script&gt;
  let win = window.frames.example;

  win.postMessage(&quot;message&quot;, &quot;http://example.com&quot;);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><p>If we don’t want that check, we can set <code>targetOrigin</code> to <code>*</code>.</p>
<div data-trusted="1" class="code-example" data-highlight-block="5-5">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;iframe src=&quot;http://example.com&quot; name=&quot;example&quot;&gt;

&lt;script&gt;
  let win = window.frames.example;

  win.postMessage(&quot;message&quot;, &quot;*&quot;);
&lt;/script&gt;</code></pre>
        </div>
      </div>
      
      </div><h3><a class="main__anchor" name="onmessage" href="#onmessage">onmessage</a></h3><p>To receive a message, the target window should have a handler on the <code>message</code> event. It triggers when <code>postMessage</code> is called (and <code>targetOrigin</code> check is successful).</p>
<p>The event object has special properties:</p>
<dl>
<dt><code>data</code></dt>
<dd>The data from <code>postMessage</code>.</dd>
<dt><code>origin</code></dt>
<dd>The origin of the sender, for instance <code>http://javascript.info</code>.</dd>
<dt><code>source</code></dt>
<dd>The reference to the sender window. We can immediately <code>postMessage</code> back if we want.</dd>
</dl>
<p>To assign that handler, we should use <code>addEventListener</code>, a short syntax <code>window.onmessage</code> does not work.</p>
<p>Here’s an example:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">window.addEventListener(&quot;message&quot;, function(event) {
  if (event.origin != 'http://javascript.info') {
    // something from an unknown domain, let's ignore it
    return;
  }

  alert( &quot;received: &quot; + event.data );
});</code></pre>
        </div>
      </div>
      
      </div><p>The full example:</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left class="code-tabs__scroll-button code-tabs__scroll-button_left"></button></div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">iframe.html</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right class="code-tabs__scroll-button code-tabs__scroll-button_right"></button></div><div class="code-tabs__buttons"><a target="_blank" title="open in a new window" href="article/cross-window-communication/postmessage/index.html" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/VdwsXBF8rp8KLmub4q26?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content style="height:120px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="article/cross-window-communication/postmessage/index.html" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;/head&gt;

&lt;body&gt;

  Receiving iframe.
  &lt;script&gt;
    window.addEventListener('message', function(event) {
      alert(`Received ${event.data} from ${event.origin}`);
    });
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;form id=&quot;form&quot;&gt;
    &lt;input type=&quot;text&quot; placeholder=&quot;Enter message&quot; name=&quot;message&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Click to send&quot;&gt;
  &lt;/form&gt;

  &lt;iframe src=&quot;iframe.html&quot; id=&quot;iframe&quot; style=&quot;display:block;height:60px&quot;&gt;&lt;/iframe&gt;

  &lt;script&gt;
    form.onsubmit = function() {
      iframe.contentWindow.postMessage(this.message.value, '*');
      return false;
    };
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><div class="important important_smart">
            <div class="important__header"><span class="important__type">There’s no delay</span></div>
            <div class="important__content"><p>There’s totally no delay between <code>postMessage</code> and the <code>message</code> event. That happens synchronously, even faster than <code>setTimeout(...,0)</code>.</p>
</div></div>
<h2><a class="main__anchor" name="summary" href="#summary">Summary</a></h2><p>To call methods and access the content of another window, we should first have a reference to it.</p>
<p>For popups we have two properties:</p>
<ul>
<li><code>window.open</code> – opens a new window and returns a reference to it,</li>
<li><code>window.opener</code> – a reference to the opener window from a popup</li>
</ul>
<p>For iframes, we can access parent/children windows using:</p>
<ul>
<li><code>window.frames</code> – a collection of nested window objects,</li>
<li><code>window.parent</code>, <code>window.top</code> are the references to parent and top windows,</li>
<li><code>iframe.contentWindow</code> is the window inside an <code>&lt;iframe&gt;</code> tag.</li>
</ul>
<p>If windows share the same origin (host, port, protocol), then windows can do whatever they want with each other.</p>
<p>Otherwise, only possible actions are:</p>
<ul>
<li>Change the location of another window (write-only access).</li>
<li>Post a message to it.</li>
</ul>
<p>Exclusions are:</p>
<ul>
<li>Windows that share the same second-level domain: <code>a.site.com</code> and <code>b.site.com</code>. Then setting <code>document.domain='site.com'</code> in both of them puts them into the “same origin” state.</li>
<li>If an iframe has a <code>sandbox</code> attribute, it is forcefully put into the “different origin” state, unless the <code>allow-same-origin</code> is specified in the attribute value. That can be used to run untrusted code in iframes from the same site.</li>
</ul>
<p>The <code>postMessage</code> interface allows two windows to talk with security checks:</p>
<ol>
<li>
<p>The sender calls <code>targetWin.postMessage(data, targetOrigin)</code>.</p>
</li>
<li>
<p>If <code>targetOrigin</code> is not <code>'*'</code>, then the browser checks if window <code>targetWin</code> has the URL from  <code>targetWin</code> site.</p>
</li>
<li>
<p>If it is so, then <code>targetWin</code> triggers the <code>message</code> event with special properties:</p>
<ul>
<li><code>origin</code> – the origin of the sender window (like <code>http://my.site.com</code>)</li>
<li><code>source</code> – the reference to the sender window.</li>
<li><code>data</code> – the data, any object in everywhere except IE that supports only strings.</li>
</ul>
<p>We should use <code>addEventListener</code> to set the handler for this event inside the target window.</p>
</li>
</ol>
</div></article><!--if lang == 'en'--><!--  include /blocks/banner-bottom.en--></div><div class="page__nav-wrap"><a href="popup-windows.html" data-tooltip="Popups and window methods" class="page__nav page__nav_prev"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Previous lesson</span></a><a href="clickjacking.html" data-tooltip="The clickjacking attack" class="page__nav page__nav_next"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Next lesson</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_vk"></a></div><div class="article-tablet-foot__map"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div></div><div id="comments" class="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Comments</a></h2><div class="comments__read-before"><span class="comments__read-before-link">read this before commenting…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>You're welcome to post additions, questions to the articles and answers to them.</li><li>To insert a few words of code, use the <code>&lt;code&gt;</code> tag, for several lines – use <code>&lt;pre&gt;</code>, for more than 10 lines – use a sandbox (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>If you can't understand something in the article – please elaborate.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/javascript.info\/cross-window-communication","identifier":"\/cross-window-communication","title":"Cross-window communication"}); };</script><script>var disqus_shortname = "javascriptinfo";</script><script>var disqus_enabled = true;</script></main></div><div class="page__sidebar sidebar sidebar_sticky-footer"><button data-sidebar-toggle class="sidebar__toggle"></button><a href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Tutorial map" class="map"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Chapter</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="frames-and-windows.html" class="sidebar__link">Frames and windows</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Lesson navigation</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#same-origin" class="sidebar__link">Same Origin</a></li><li class="sidebar__navigation-link"><a href="#accessing-an-iframe-contents" class="sidebar__link">Accessing an iframe contents</a></li><li class="sidebar__navigation-link"><a href="#window-frames" class="sidebar__link">window.frames</a></li><li class="sidebar__navigation-link"><a href="#the-sandbox-attribute" class="sidebar__link">The sandbox attribute</a></li><li class="sidebar__navigation-link"><a href="#cross-window-messaging" class="sidebar__link">Cross-window messaging</a></li><li class="sidebar__navigation-link"><a href="#summary" class="sidebar__link">Summary</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#comments" class="sidebar__link">Comments</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Share</div><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_tw sidebar__share"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_fb sidebar__share"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fcross-window-communication" class="share share_gp sidebar__share"></a></div><div class="sidebar__section"><a href="https://github.com/iliakan/javascript-tutorial-en/tree/master/4-frames-and-windows/03-cross-window-communication/article.md" class="sidebar__link">Edit on Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Ilya Kantor</li><li class="page-footer__item"><a href="about.html#contact-us" class="page-footer__link">contact us</a></li><li class="page-footer__item"><a href="about.html" class="page-footer__link">about the project</a></li><li class="page-footer__item"><a href="https://learn.javascript.ru/" class="page-footer__link">RU</a> / EN</li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li class="page-footer__item">powered by <a rel="nofollow" href="http://nodejs.org/" class="page-footer__link">node.js</a>&nbsp;&amp;&nbsp;<a rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-en" class="page-footer__link">open source</a></li></ul></div></div></body>
<!-- Mirrored from javascript.info/cross-window-communication by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:24 GMT -->
</html>