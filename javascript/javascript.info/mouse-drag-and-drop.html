<!DOCTYPE html><html lang="en">
<!-- Mirrored from javascript.info/mouse-drag-and-drop by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><title itemprop="name">Drag'n'Drop with mouse events</title><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="mouse-drag-and-drop.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><!-- favicon the rest--><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://javascript.info/img/site_preview_en_512x512.png"><meta property="og:title" content="Drag'n'Drop with mouse events"><meta property="og:image" content="https://javascript.info/img/site_preview_en_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Drag'n'Drop with mouse events"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://javascript.info/img/site_preview_en_512x512.png"><link href="pack/styles.b363cbd7204b6ec74a4cbeca7061b31d.css" rel="stylesheet"><link rel="prev" href="mousemove-mouseover-mouseout-mouseenter-mouseleave.html"><link rel="next" href="keyboard-events.html"><script>window.GA_ID = "UA-2056213-15";</script><script>window.YANDEX_METRIKA_ID = 32184394;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var n=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),r=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+n+" "+r,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="inite4da.js?5"></script><script src="pack/head.5ac6aee21473ea597203.js" defer></script><meta property="og:title" content="Drag'n'Drop with mouse events"><meta property="og:type" content="article"><script src="pack/tutorial.5ac6aee21473ea597203.js" defer></script><script src="pack/footer.5ac6aee21473ea597203.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Sorry, IE&lt;10 is not supported, please use a newer browser.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div style="display:none" id="notify-en-tutorial" class="notification notification_info notification_top sitetoolbar__notification"><div class="notification__content">The tutorial was recently rewritten from scratch. There may be typos, please use the "Edit on Github" link (in left sidebar in an article, at the bottom) to propose fixes.
Thank you!</div><button title="Close" class="notification__close"></button></div><script>showTopNotification();</script><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a href="index.html" class="sitetoolbar__link sitetoolbar__link_logo"><img src="img/sitetoolbar__logo_en.svg" width="200" class="sitetoolbar__logo sitetoolbar__logo_normal" alt=""><img src="img/sitetoolbar__logo_small_en.svg" width="70" class="sitetoolbar__logo sitetoolbar__logo_small" alt=""><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){var t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button type="button" class="sitetoolbar__nav-toggle"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a href="index.html" class="sitetoolbar__link">Tutorial</a></li><li class="sitetoolbar__section"><a href="courses.html" class="sitetoolbar__link">Courses</a></li></ul></nav><div class="sitetoolbar__book-wrap"><a href="ebook.html" class="buy-book-button"><span class="buy-book-button__extra-text">Buy</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button data-action-login class="sitetoolbar__login sitetoolbar__login_unready"></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form method="GET" action="http://javascript.info/search" class="sitetoolbar__search"><button type="button" class="sitetoolbar__search-toggle"></button><div class="sitetoolbar__search-input"><div class="text-input"><input autofocus name="query" placeholder="Search on Javascript.info" class="text-input__control" type="text"></div><button type="submit" class="sitetoolbar__find">Search</button></div></form></div></div></div><!-- todo: en variant--><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select onchange="if(this.value) window.location.href=this.value" class="input-select input-select_small tablet-menu__nav"><option value="/tutorial" selected>Tutorial</option><option value="/courses">Courses</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form action="http://javascript.info/search/" class="tablet-menu-search"><input type="search" name="query" placeholder="Search in the tutorial" required class="tablet-menu-search__input"><button type="submit" name="type" value="articles" class="tablet-menu-search__button">Search</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div><!--+e.line--><!--  +e.content--><!--    +b("a").tablet-ebook(href="/ebook")--><!--      +e("span").text Купить учебник--><!--      +e("span").note (EPUB + PDF)--><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_vk"></a></div></div></div></div><progress data-sticky value="19" max="27" data-tooltip="Lesson 19 of 27" class="tutorial-progress"></progress></div><div class="page page_sidebar_on"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1" class="breadcrumbs__item breadcrumbs__item_home"><a href="index.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title" class="breadcrumbs__hidden-text">Tutorial</span></a></li><li id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-2" itemprop="child" class="breadcrumbs__item"><a href="ui.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">Browser: Document, Events, Interfaces</span></a></li><li id="breadcrumb-2" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child" class="breadcrumbs__item"><a href="event-details.html" itemprop="url" class="breadcrumbs__link"><span itemprop="title">Events in details</span></a></li></ol><h1 class="main__header-title">Drag'n'Drop with mouse events</h1></div></header><div class="content"><article itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Drag'n'Drop with mouse events"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>Drag’n’Drop is a great interface solution. Taking something, dragging and dropping is a clear and simple way to do many things, from copying and moving (see file managers) to ordering (drop into cart).</p>
<p>In the modern HTML standard there’s a <a href="https://html.spec.whatwg.org/multipage/interaction.html#dnd">section about Drag Events</a>.</p>
<p>They are interesting, because they allow to solve simple tasks easily, and also allow to handle drag’n’drop of “external” files into the browser. So we can take a file in the OS file-manager and drop it into the browser window. Then JavaScript gains access to its contents.</p>
<p>But native Drag Events also have limitations. For instance, we can limit dragging by a certain area. Also we can’t make it “horizontal” or “vertical” only. There are other drag’n’drop tasks that can’t be implemented using that API.</p>
<p>So here we’ll see how to implement Drag’n’Drop using mouse events. Not that hard either.</p>
<h2><a class="main__anchor" name="drag-n-drop-algorithm" href="#drag-n-drop-algorithm">Drag’n’Drop algorithm</a></h2><p>The basic Drag’n’Drop algorithm looks like this:</p>
<ol>
<li>Catch <code>mousedown</code> on a draggable element.</li>
<li>Prepare the element to moving (maybe create a copy of it or whatever).</li>
<li>Then on <code>mousemove</code> move it by changing <code>left/top</code> and <code>position:absolute</code>.</li>
<li>On <code>mouseup</code> (button release) – perform all actions related to a finished Drag’n’Drop.</li>
</ol>
<p>These are the basics. We can extend it, for instance, by highlighting droppable (available for the drop) elements when hovering over them.</p>
<p>Here’s the algorithm for drag’n’drop of a ball:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.onmousedown = function(event) { // (1) start the process

  // (2) prepare to moving: make absolute and on top by z-index
  ball.style.position = 'absolute';
  ball.style.zIndex = 1000;
  // move it out of any current parents directly into body
  // to make it positioned relative to the body
  document.body.append(ball);
  // ...and put that absolutely positioned ball under the cursor

  moveAt(event.pageX, event.pageY);

  // centers the ball at (pageX, pageY) coordinates
  function moveAt(pageX, pageY) {
    ball.style.left = pageX - ball.offsetWidth / 2 + 'px';
    ball.style.top = pageY - ball.offsetHeight / 2 + 'px';
  }

  function onMouseMove(event) {
    moveAt(event.pageX, event.pageY);
  }

  // (3) move the ball on mousemove
  document.addEventListener('mousemove', onMouseMove);

  // (4) drop the ball, remove unneeded handlers
  ball.onmouseup = function() {
    document.removeEventListener('mousemove', onMouseMove);
    ball.onmouseup = null;
  };

};</code></pre>
        </div>
      </div>
      
      </div><p>If we run the code, we can notice something strange. On the beginning of the drag’n’drop, the ball “forks”: we start to dragging it’s “clone”.</p>
<p>Here’s an example in action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball/"></iframe>
  </div><p>Try to drag’n’drop the mouse and you’ll see the strange behavior.</p>
<p>That’s because the browser has its own Drag’n’Drop for images and some other elements that runs automatically and conflicts with ours.</p>
<p>To disable it:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.ondragstart = function() {
  return false;
};</code></pre>
        </div>
      </div>
      
      </div><p>Now everything will be all right.</p>
<p>In action:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball2/"></iframe>
  </div><p>Another important aspect – we track <code>mousemove</code> on <code>document</code>, not on <code>ball</code>. From the first sight it may seem that the mouse is always over the ball, and we can put <code>mousemove</code> on it.</p>
<p>But as we remember, <code>mousemove</code> triggers often, but not for every pixel. So after swift move the cursor can jump from the ball somewhere in the middle of document (or even outside of the window).</p>
<p>So we should listen on <code>document</code> to catch it.</p>
<h2><a class="main__anchor" name="correct-positioning" href="#correct-positioning">Correct positioning</a></h2><p>In the examples above the ball is always centered under the pointer:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.style.left = pageX - ball.offsetWidth / 2 + 'px';
ball.style.top = pageY - ball.offsetHeight / 2 + 'px';</code></pre>
        </div>
      </div>
      
      </div><p>Not bad, but there’s a side-effect. To initiate the drag’n’drop can we <code>mousedown</code> anywhere on the ball. If do it at the edge, then the ball suddenly “jumps” to become centered.</p>
<p>It would be better if we keep the initial shift of the element relative to the pointer.</p>
<p>For instance, if we start dragging by the edge of the ball, then the cursor should remain over the edge while dragging.</p>
<figure><div class="image" style="width:156px">
      <div class="image__ratio" style="padding-top:83.97435897435898%"></div>
      <img src="article/mouse-drag-and-drop/ball_shift.png" alt="" width="156" height="131" class="image__image">
      </div></figure><ol>
<li>
<p>When a visitor presses the button (<code>mousedown</code>) – we can remember the distance from the cursor to the left-upper corner of the ball in variables <code>shiftX/shiftY</code>. We should keep that distance while dragging.</p>
<p>To get these shifts we can substract the coordinates:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// onmousedown
let shiftX = event.clientX - ball.getBoundingClientRect().left;
let shiftY = event.clientY - ball.getBoundingClientRect().top;</code></pre>
        </div>
      </div>
      
      </div><p>Please note that there’s no method to get document-relative coordinates in JavaScript, so we use window-relative coordinates here.</p>
</li>
<li>
<p>Then while dragging we position the ball on the same shift relative to the pointer, like this:</p>
<div data-trusted="1" class="code-example" data-highlight-inline="2:32-38,3:31-37">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// onmousemove
// ball has position:absoute
ball.style.left = event.pageX - shiftX + 'px';
ball.style.top = event.pageY - shiftY + 'px';</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>The final code with better positioning:</p>
<div data-trusted="1" class="code-example" data-highlight-block="2-3" data-highlight-inline="13:30-36,14:29-35">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">ball.onmousedown = function(event) {

  let shiftX = event.clientX - ball.getBoundingClientRect().left;
  let shiftY = event.clientY - ball.getBoundingClientRect().top;

  ball.style.position = 'absolute';
  ball.style.zIndex = 1000;
  document.body.append(ball);

  moveAt(event.pageX, event.pageY);

  // centers the ball at (pageX, pageY) coordinates
  function moveAt(pageX, pageY) {
    ball.style.left = pageX - shiftX + 'px';
    ball.style.top = pageY - shiftY + 'px';
  }

  function onMouseMove(event) {
    moveAt(event.pageX, event.pageY);
  }

  // (3) move the ball on mousemove
  document.addEventListener('mousemove', onMouseMove);

  // (4) drop the ball, remove unneeded handlers
  ball.onmouseup = function() {
    document.removeEventListener('mousemove', onMouseMove);
    ball.onmouseup = null;
  };

};

ball.ondragstart = function() {
  return false;
};</code></pre>
        </div>
      </div>
      
      </div><p>In action (inside <code>&lt;iframe&gt;</code>):</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:230px" src="https://en.js.cx/article/mouse-drag-and-drop/ball3/"></iframe>
  </div><p>The difference is especially noticeable if we drag the ball by it’s right-bottom corner. In the previous example the ball “jumps” under the pointer. Now it fluently follows the cursor from the current position.</p>
<h2><a class="main__anchor" name="detecting-droppables" href="#detecting-droppables">Detecting droppables</a></h2><p>In previous examples the ball could be dropped just “anywhere” to stay. In real-life we usually take one element and drop it onto another. For instance, a file into a folder, or a user into a trash can or whatever.</p>
<p>Abstractly, we take a “draggable” element and drop it onto “droppable” element.</p>
<p>We need to know the target droppable at the end of Drag’n’Drop – to do the corresponding action, and, preferably, during the dragging process, to highlight it.</p>
<p>The solution is kind-of interesting and just a little bit tricky, so let’s cover it here.</p>
<p>What’s the first idea? Probably to put <code>onmouseover/mouseup</code> handlers on potential droppables and detect when the mouse pointer appears over them. And then we know that we are dragging/dropping on that element.</p>
<p>But that doesn’t work.</p>
<p>The problem is that, while we’re dragging, the draggable element is always above other elements. And mouse events only happen on the top element, not on those below it.</p>
<p>For instance, below are two <code>&lt;div&gt;</code> elements, red on top of blue. There’s no way to catch an event on the blue one, because the red is on top:</p>
<div data-trusted="1" class="code-example" data-demo-height="60" data-autorun="true">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="#" title="show" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="#" title="open in sandbox" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code class="language-markup">&lt;style&gt;
  div {
    width: 50px;
    height: 50px;
    position: absolute;
    top: 0;
  }
&lt;/style&gt;
&lt;div style=&quot;background:blue&quot; onmouseover=&quot;alert('never works')&quot;&gt;&lt;/div&gt;
&lt;div style=&quot;background:red&quot; onmouseover=&quot;alert('over red!')&quot;&gt;&lt;/div&gt;</code></pre>
        </div>
      </div>
      <div class="code-result code-example__result">
        <iframe
          class="code-result__iframe"
          name="code-result-43ue15"
          style="height:60px"
          src="about:blank"></iframe>
      </div>
      </div><p>The same with a draggable element. The ball in always on top over other elements, so events happen on it. Whatever handlers we set on lower elements, they won’t work.</p>
<p>That’s why the initial idea to put handlers on potential droppables doesn’t work in practice. They won’t run.</p>
<p>So, what to do?</p>
<p>There’s a method called <code>document.elementFromPoint(clientX, clientY)</code>. It returns the most nested element on given window-relative coordinates (or <code>null</code> if coordinates are out of the window).</p>
<p>So in any of our mouse event handlers we can detect the potential droppable under the pointer like this:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// in a mouse event handler
ball.hidden = true; // (*)
let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
ball.hidden = false;
// elemBelow is the element below the ball. If it's droppable, we can handle it.</code></pre>
        </div>
      </div>
      
      </div><p>Please note: we need to hide the ball before the call <code>(*)</code>. Otherwise we’ll usually have a ball on these coordinates, as it’s the top element under the pointer: <code>elemBelow=ball</code>.</p>
<p>We can use that code to check what we’re “flying over” at any time. And handle the drop when it happens.</p>
<p>An extended code of <code>onMouseMove</code> to find “droppable” elements:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">let currentDroppable = null; // potential droppable that we're flying over right now

function onMouseMove(event) {
  moveAt(event.pageX, event.pageY);

  ball.hidden = true;
  let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
  ball.hidden = false;

  // mousemove events may trigger out of the window (when the ball is dragged off-screen)
  // if clientX/clientY are out of the window, then elementfromPoint returns null
  if (!elemBelow) return;

  // potential droppables are labeled with the class &quot;droppable&quot; (can be other logic)
  let droppableBelow = elemBelow.closest('.droppable');

  if (currentDroppable != droppableBelow) { // if there are any changes
    // we're flying in or out...
    // note: both values can be null
    //   currentDroppable=null if we were not over a droppable (e.g over an empty space)
    //   droppableBelow=null if we're not over a droppable now, during this event

    if (currentDroppable) {
      // the logic to process &quot;flying out&quot; of the droppable (remove highlight)
      leaveDroppable(currentDroppable);
    }
    currentDroppable = droppableBelow;
    if (currentDroppable) {
      // the logic to process &quot;flying in&quot; of the droppable
      enterDroppable(currentDroppable);
    }
  }
}</code></pre>
        </div>
      </div>
      
      </div><p>In the example below when the ball is dragged over the soccer gate, the gate is highlighted.</p>
<div class="code-tabs code-tabs_result_on"><div class="code-tabs__tools"><div class="code-tabs__scroll-wrap"><button title="&amp;larr;" data-code-tabs-left class="code-tabs__scroll-button code-tabs__scroll-button_left"></button></div><div class="code-tabs__switches-wrap"><div data-code-tabs-switches class="code-tabs__switches"><div class="code-tabs__switches-items"><div class="code-tabs__switch code-tabs__switch_current">Result</div><div class="code-tabs__switch">style.css</div><div class="code-tabs__switch">index.html</div></div></div></div><div class="code-tabs__scroll-wrap"><button title="&amp;rarr;" data-code-tabs-right class="code-tabs__scroll-button code-tabs__scroll-button_right"></button></div><div class="code-tabs__buttons"><a target="_blank" title="open in a new window" href="article/mouse-drag-and-drop/ball4/index.html" class="code-tabs__button code-tabs__button_external"></a><a target="_blank" title="edit in the sandbox" href="http://plnkr.co/edit/y7npeUlYqWbTbbFzIZND?p=preview" class="code-tabs__button code-tabs__button_edit"></a></div></div><div data-code-tabs-content style="height:250px" class="code-tabs__content"><div class="code-tabs__section code-tabs__section_current"><iframe src="article/mouse-drag-and-drop/ball4/index.html" class="code-tabs__result"></iframe></div><div class="code-tabs__section"><pre class="language-css line-numbers"><code>#gate {
  cursor: pointer;
  margin-bottom: 100px;
  width: 83px;
  height: 46px;
}

#ball {
  cursor: pointer;
  width: 40px;
  height: 40px;
}</code></pre></div><div class="code-tabs__section"><pre class="language-markup line-numbers"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;p&gt;Drag the ball.&lt;/p&gt;

  &lt;img src=&quot;https://en.js.cx/clipart/soccer-gate.svg&quot; id=&quot;gate&quot; class=&quot;droppable&quot;&gt;

  &lt;img src=&quot;https://en.js.cx/clipart/ball.svg&quot; id=&quot;ball&quot;&gt;

  &lt;script&gt;
    let currentDroppable = null;

    ball.onmousedown = function(event) {

      let shiftX = event.clientX - ball.getBoundingClientRect().left;
      let shiftY = event.clientY - ball.getBoundingClientRect().top;

      ball.style.position = 'absolute';
      ball.style.zIndex = 1000;
      document.body.append(ball);

      moveAt(event.pageX, event.pageY);

      function moveAt(pageX, pageY) {
        ball.style.left = pageX - shiftX + 'px';
        ball.style.top = pageY - shiftY + 'px';
      }

      function onMouseMove(event) {
        moveAt(event.pageX, event.pageY);

        ball.hidden = true;
        let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
        ball.hidden = false;

        if (!elemBelow) return;

        let droppableBelow = elemBelow.closest('.droppable');
        if (currentDroppable != droppableBelow) {
          if (currentDroppable) { // null when we were not over a droppable before this event
            leaveDroppable(currentDroppable);
          }
          currentDroppable = droppableBelow;
          if (currentDroppable) { // null if we're not coming over a droppable now
            // (maybe just left the droppable)
            enterDroppable(currentDroppable);
          }
        }
      }

      document.addEventListener('mousemove', onMouseMove);

      ball.onmouseup = function() {
        document.removeEventListener('mousemove', onMouseMove);
        ball.onmouseup = null;
      };

    };

    function enterDroppable(elem) {
      elem.style.background = 'pink';
    }

    function leaveDroppable(elem) {
      elem.style.background = '';
    }

    ball.ondragstart = function() {
      return false;
    };
  &lt;/script&gt;


&lt;/body&gt;
&lt;/html&gt;</code></pre></div></div></div><p>Now we have the current “drop target” in the variable <code>currentDroppable</code> during the whole process and can use it to highlight or any other stuff.</p>
<h2><a class="main__anchor" name="summary" href="#summary">Summary</a></h2><p>We considered a basic <code>Drag'n'Drop</code> algorithm.</p>
<p>The key components:</p>
<ol>
<li>Events flow: <code>ball.mousedown</code> → <code>document.mousemove</code> → <code>ball.mouseup</code> (cancel native <code>ondragstart</code>).</li>
<li>At the drag start – remember the initial shift of the pointer relative to the element: <code>shiftX/shiftY</code> and keep it during the dragging.</li>
<li>Detect droppable elements under the pointer using <code>document.elementFromPoint</code>.</li>
</ol>
<p>We can lay a lot on this foundation.</p>
<ul>
<li>On <code>mouseup</code> we can finalize the drop: change data, move elements around.</li>
<li>We can highlight the elements we’re flying over.</li>
<li>We can limit dragging by a certain area or direction.</li>
<li>We can use event delegation for <code>mousedown/up</code>. A large-area event handler that checks  <code>event.target</code> can manage Drag’n’Drop for hundreds of elements.</li>
<li>And so on.</li>
</ul>
<p>There are frameworks that build architecture over it: <code>DragZone</code>, <code>Droppable</code>, <code>Draggable</code> and other classes. Most of them do the similar stuff to described above, so it should be easy to understand them now. Or roll our own, because you already know how to handle the process, and it may be more flexible than to adapt something else.</p>
</div></article><div class="tasks"><h2 id="tasks" class="tasks__title"><a href="#tasks" class="main__anchor main__anchor_noicon tasks__title-anchor">Tasks</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#slider" name="slider" class="main__anchor">Slider</a></h3><a href="task/slider.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>Create a slider:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"></div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:60px" src="https://en.js.cx/task/slider/solution/"></iframe>
  </div><p>Drag the blue thumb with the mouse and move it.</p>
<p>Important details:</p>
<ul>
<li>When the mouse button is pressed, during the dragging the mouse may go over or below the slider. The slider will still work (convenient for the user).</li>
<li>If the mouse moves very fast to the left or to the right, the thumb should stop exactly at the edge.</li>
</ul>
<p><a href="http://plnkr.co/edit/a2HZc7cd47K9esLrCi7a?p=preview" target="_blank" data-plunk-id="a2HZc7cd47K9esLrCi7a">Open the sandbox for the task.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p>We have a horizontal Drag’n’Drop here.</p>
<p>To position the element we use <code>position:relative</code> and slider-relative coordinates for the thumb. Here it’s more convenient here than <code>position:absolute</code>.</p>
<p><a href="http://plnkr.co/edit/OAW7ZxlejVp6XCR7gyq2?p=preview" target="_blank" data-plunk-id="OAW7ZxlejVp6XCR7gyq2">Open the solution in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a href="#drag-superheroes-around-the-field" name="drag-superheroes-around-the-field" class="main__anchor">Drag superheroes around the field</a></h3><a href="task/drag-heroes.html" target="_blank" class="task__open-link"></a></div><div class="task__header-note"><span title="How important is the task, from 1 to 5" class="task__importance">importance: 5</span></div><div class="task__content"><p>This task can help you to check understanding of several aspects of Drag’n’Drop and DOM.</p>
<p>Make all elements with class <code>draggable</code> – draggable. Like a ball in the chapter.</p>
<p>Requirements:</p>
<ul>
<li>Use event delegation to track drag start: a single event handler on <code>document</code> for <code>mousedown</code>.</li>
<li>If elements are dragged to top/bottom window edges – the page scrolls up/down to allow further dragging.</li>
<li>There is no horizontal scroll.</li>
<li>Draggable elements should never leave the window, even after swift mouse moves.</li>
</ul>
<p>The demo is too big to fit it here, so here’s the link.</p>
<p><a href="https://en.js.cx/task/drag-heroes/solution/" target="blank">Demo in new window</a></p><p><a href="http://plnkr.co/edit/ql3SkU6CsJ3ci6zyKqS7?p=preview" target="_blank" data-plunk-id="ql3SkU6CsJ3ci6zyKqS7">Open the sandbox for the task.</a></p><button type="button" class="task__solution">solution</button><div class="task__answer"><div class="task__answer-content"><p>To drag the element we can use <code>position:fixed</code>, it makes coordinates easier to manage. At the end we should switch it back to <code>position:absolute</code>.</p>
<p>Then, when coordinates are at window top/bottom, we use <code>window.scrollTo</code> to scroll it.</p>
<p>More details in the code, in comments.</p>
<p><a href="http://plnkr.co/edit/sCSdBOHOdDFMqRoxFUC0?p=preview" target="_blank" data-plunk-id="sCSdBOHOdDFMqRoxFUC0">Open the solution in the sandbox.</a></p></div><button type="button" title="close" class="close-button task__answer-close"></button></div></div></div></div></div><!--if lang == 'en'--><!--  include /blocks/banner-bottom.en--></div><div class="page__nav-wrap"><a href="mousemove-mouseover-mouseout-mouseenter-mouseleave.html" data-tooltip="Moving: mouseover/out, mouseenter/leave" class="page__nav page__nav_prev"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Previous lesson</span></a><a href="keyboard-events.html" data-tooltip="Keyboard: keydown and keyup" class="page__nav page__nav_next"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Next lesson</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Share</span><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_tw"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_fb"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_gp"></a><a href="https://vkontakte.ru/share.php?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_vk"></a></div><div class="article-tablet-foot__map"><a href="tutorial/map.html" data-action="tutorial-map" class="map"><span class="map__text">Tutorial map</span></a></div></div></div><div id="comments" class="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Comments</a></h2><div class="comments__read-before"><span class="comments__read-before-link">read this before commenting…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>You're welcome to post additions, questions to the articles and answers to them.</li><li>To insert a few words of code, use the <code>&lt;code&gt;</code> tag, for several lines – use <code>&lt;pre&gt;</code>, for more than 10 lines – use a sandbox (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>If you can't understand something in the article – please elaborate.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/javascript.info\/mouse-drag-and-drop","identifier":"\/mouse-drag-and-drop","title":"Drag'n'Drop with mouse events"}); };</script><script>var disqus_shortname = "javascriptinfo";</script><script>var disqus_enabled = true;</script></main></div><div class="page__sidebar sidebar sidebar_sticky-footer"><button data-sidebar-toggle class="sidebar__toggle"></button><a href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Tutorial map" class="map"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Chapter</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="event-details.html" class="sidebar__link">Events in details</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Lesson navigation</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#drag-n-drop-algorithm" class="sidebar__link">Drag’n’Drop algorithm</a></li><li class="sidebar__navigation-link"><a href="#correct-positioning" class="sidebar__link">Correct positioning</a></li><li class="sidebar__navigation-link"><a href="#detecting-droppables" class="sidebar__link">Detecting droppables</a></li><li class="sidebar__navigation-link"><a href="#summary" class="sidebar__link">Summary</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a href="#tasks" class="sidebar__link">Tasks (2)</a></li><li class="sidebar__navigation-link"><a href="#comments" class="sidebar__link">Comments</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Share</div><a href="https://twitter.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_tw sidebar__share"></a><a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_fb sidebar__share"></a><a href="https://plus.google.com/share?url=https%3A%2F%2Fjavascript.info%2Fmouse-drag-and-drop" class="share share_gp sidebar__share"></a></div><div class="sidebar__section"><a href="https://github.com/iliakan/javascript-tutorial-en/tree/master/2-ui/3-event-details/4-mouse-drag-and-drop/article.md" class="sidebar__link">Edit on Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Ilya Kantor</li><li class="page-footer__item"><a href="about.html#contact-us" class="page-footer__link">contact us</a></li><li class="page-footer__item"><a href="about.html" class="page-footer__link">about the project</a></li><li class="page-footer__item"><a href="https://learn.javascript.ru/" class="page-footer__link">RU</a> / EN</li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li class="page-footer__item">powered by <a rel="nofollow" href="http://nodejs.org/" class="page-footer__link">node.js</a>&nbsp;&amp;&nbsp;<a rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-en" class="page-footer__link">open source</a></li></ul></div></div></body>
<!-- Mirrored from javascript.info/mouse-drag-and-drop by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 10 Sep 2018 10:51:03 GMT -->
</html>